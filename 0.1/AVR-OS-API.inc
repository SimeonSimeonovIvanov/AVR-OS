/*
			AVR-Os Version 0.1
		
		The^day^of^DooM

	Create date:   01.02.2006
	Last Update:   11.02.2006

					Карта на памета:
   ----------------------------------------------------------------------------
	Резервираната част на OS (процес номер 0) [3 байта]:	
		$0061 - Брой на процесите
		$0062 - Номера на процеса изпълняван в момента
		$0063 - Резервиран
   ----------------------------------------------------------------------------
	Масив на процесите - съставен от отделни
	структури по [3 байта]:
		((Номер на процеса)*3)+0 - Младши байт от адреса на процеса
		((Номер на процеса)*3)+1 - Старша част от адреса на процеса
		((Номер на процеса)*3)+2 - Байт оказващ времето за изпоолзване от OS
   ----------------------------------------------------------------------------

   I) Инициализиране на стека
   II) Създаване на процеси
   III) Пускане на OS
   (добавяне и премахване* на процеси, тяхното изпълнение)

		*при премахване на даден процес то слдващите след него (ако има)
		 си смъкват номера с един надоло.
*/

// ---------------------------
.macro OSIRQ
	jmp RESET
.endmacro
// ---------------------------
.macro OSInit
	ldi r16, low(ramend)
	out spl, r16
	ldi r16, high(ramend)
	out sph, r16
	call OSInitF
.endmacro
// ---------------------------
.macro OSCreateTask
	push r16
	push r17
	push r18

	ldi r16, low(@0)
	ldi r17, high(@0)
	ldi r18, @1
	call OSCreateTaskF
	
	pop r18
	pop r17
	pop r16
.endmacro
// ---------------------------
.macro OSRun
	call OSRunF
.endmacro
// ---------------------------
.macro OSRemoveTask
	push r16
	ldi r16, @0
	call OSRemoveTaskF
	pop r16
.endmacro
