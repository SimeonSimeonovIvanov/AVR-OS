<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<!--
Syntax highlighting generated by Web C Plus Plus software v0.8.4
Webcpp Copyright (C)2001-2004 Jeffrey Bakker under the GNU GPL
Get webcpp at http://webcpp.sf.net
-->

<html>
<head>
<title>jm162a.inc</title>
<style type="text/css">

/*
Webcpp v0.8.1 compatible StyleSheet
http://webcpp.sf.net
Theme: typical
*/

body
{
background-color: #f9f9f9
}

.webcpp a:link    {color:#00b800}
.webcpp a:visited {color:#666666}
.webcpp a:active  {color:#224fff}
.webcpp a:hover   {color:#a900a9}

.webcpp pre
{
color: #000000
}

.webcpp font
{
font-size:100%
}

.webcpp .symbols
{
color: #0077dd
}

.webcpp .preproc
{
color: #a900a9
}

.webcpp .integer
{
color: #ff0032
}

.webcpp .floatpt
{
color: #ff23a6
}

.webcpp .dblquot
{
color: #00b800
}

.webcpp .sinquot
{
color: #00b86b
}

.webcpp .keyword
{
color: #224fff;
font-weight: bold
}

.webcpp .keytype
{
color: #ff9933;
font-weight: bold
}

.webcpp .comment
{
color: #666666;
font-style: italic
}

</style>
</head>
<body>

<div class="webcpp">
<pre>

     <font CLASS=comment>1:</font> <font CLASS=comment>/*
     <font CLASS=comment>2:</font> 	 The^day^of^DooM
     <font CLASS=comment>3:</font> 
     <font CLASS=comment>4:</font>     Avr Studio 4
     <font CLASS=comment>5:</font> 
     <font CLASS=comment>6:</font>     Create date:   29.04.2006
     <font CLASS=comment>7:</font>     Last Update:   07.07.2006
     <font CLASS=comment>8:</font> */</font>
     <font CLASS=comment>9:</font> 
    <font CLASS=comment>10:</font> <font CLASS=comment>#ifndef __DELAY_INC__</font>
    <font CLASS=comment>11:</font> 	.<font CLASS=keyword>include</font> <font CLASS=dblquot>"C:\MyINC\delay\delay.inc"</font>
    <font CLASS=comment>12:</font> <font CLASS=comment>#endif</font>
    <font CLASS=comment>13:</font> 
    <font CLASS=comment>14:</font> <font CLASS=comment>#ifndef __JM162A_INC__</font>
    <font CLASS=comment>15:</font> <font CLASS=comment>#define __JM162A_INC__</font>
    <font CLASS=comment>16:</font> 
    <font CLASS=comment>17:</font> <font CLASS=comment>#if XTAL == 4</font>
    <font CLASS=comment>18:</font> .equ JM162A_DELAY_TIME<font CLASS=symbols>=</font><font CLASS=integer>27</font>
    <font CLASS=comment>19:</font> <font CLASS=comment>#else</font>
    <font CLASS=comment>20:</font> .equ JM162A_DELAY_TIME<font CLASS=symbols>=</font><font CLASS=integer>43</font>
    <font CLASS=comment>21:</font> <font CLASS=comment>#endif</font>
    <font CLASS=comment>22:</font> 
    <font CLASS=comment>23:</font> .equ LCD_E<font CLASS=symbols>=</font><font CLASS=integer>4</font>
    <font CLASS=comment>24:</font> .equ LCD_RW<font CLASS=symbols>=</font><font CLASS=integer>5</font>
    <font CLASS=comment>25:</font> .equ LCD_RS<font CLASS=symbols>=</font><font CLASS=integer>6</font>
    <font CLASS=comment>26:</font> 
    <font CLASS=comment>27:</font> .equ LCD_DDRx=DDRA
    <font CLASS=comment>28:</font> .equ LCD_PINx=PINA
    <font CLASS=comment>29:</font> .equ LCD_PORTx=PORTA
    <font CLASS=comment>30:</font> 
    <font CLASS=comment>31:</font> .equ LCD_D0=PA0
    <font CLASS=comment>32:</font> .equ LCD_D1=PA1
    <font CLASS=comment>33:</font> .equ LCD_D2=PA2
    <font CLASS=comment>34:</font> .equ LCD_D3=PA3
    <font CLASS=comment>35:</font> 
    <font CLASS=comment>36:</font> .equ LCD_PORTx_FREE_PIN=PA7
    <font CLASS=comment>37:</font> 
    <font CLASS=comment>38:</font> JM162AInitF:
    <font CLASS=comment>39:</font> 	in r16, LCD_DDRx
    <font CLASS=comment>40:</font> 	ori r16, (<font CLASS=integer>1</font>&lt;&lt;LCD_RS)<font CLASS=symbols>|</font>(<font CLASS=integer>1</font>&lt;&lt;LCD_RW)<font CLASS=symbols>|</font>(<font CLASS=integer>1</font>&lt;&lt;LCD_E)|(<font CLASS=integer>1</font>&lt;&lt;LCD_D3)<font CLASS=symbols>|</font>(<font CLASS=integer>1</font>&lt;&lt;LCD_D2)|(<font CLASS=integer>1</font>&lt;&lt;LCD_D1)|(<font CLASS=integer>1</font>&lt;&lt;LCD_D0)
    <font CLASS=comment>41:</font> 	out LCD_DDRx, r16
    <font CLASS=comment>42:</font> 	ldi r16, <font CLASS=integer>30</font>
    <font CLASS=comment>43:</font> 	call DelayMsF
    <font CLASS=comment>44:</font> 	JM162AFunctionSet 0b00001100
    <font CLASS=comment>45:</font> 	JM162ADisplay_ON_OFF_Control 0b00000111
    <font CLASS=comment>46:</font> 	JM162AClear
    <font CLASS=comment>47:</font> 	JM162AEntryModeSet 0b00000010
    <font CLASS=comment>48:</font> ret
    <font CLASS=comment>49:</font> 
    <font CLASS=comment>50:</font> JM162AClearDisplayF: ;<font CLASS=symbols>+</font>
    <font CLASS=comment>51:</font> 	push r16
    <font CLASS=comment>52:</font> 	ldi r16, 0b00000001
    <font CLASS=comment>53:</font> 	call JM162ASendByteF
    <font CLASS=comment>54:</font> 	ldi r16, <font CLASS=integer>2</font>
    <font CLASS=comment>55:</font> 	call DelayMsF
    <font CLASS=comment>56:</font> 	pop r16
    <font CLASS=comment>57:</font> 	;call JM162WaitBusyF
    <font CLASS=comment>58:</font> ret
    <font CLASS=comment>59:</font> 
    <font CLASS=comment>60:</font> JM162AReturnToHomeF: ;<font CLASS=symbols>+</font>
    <font CLASS=comment>61:</font> 	push r16
    <font CLASS=comment>62:</font> 	ldi R16, 0b00000010
    <font CLASS=comment>63:</font> 	call JM162ASendByteF
    <font CLASS=comment>64:</font> 	ldi r16, <font CLASS=integer>2</font>
    <font CLASS=comment>65:</font> 	call DelayMsF
    <font CLASS=comment>66:</font> 	pop r16
    <font CLASS=comment>67:</font> ret
    <font CLASS=comment>68:</font> 
    <font CLASS=comment>69:</font> <font CLASS=comment>/*
    <font CLASS=comment>70:</font> 	R16 - X
    <font CLASS=comment>71:</font> 	R17 - Y
    <font CLASS=comment>72:</font> */</font>
    <font CLASS=comment>73:</font> JM162AGoToXYF:
    <font CLASS=comment>74:</font> 	tst r17
    <font CLASS=comment>75:</font> 	breq JM162A_Line0
    <font CLASS=comment>76:</font> JM162A_Line1:
    <font CLASS=comment>77:</font> 	push r17
    <font CLASS=comment>78:</font> 	ldi r17, 0x40
    <font CLASS=comment>79:</font> 	add r16, r17
    <font CLASS=comment>80:</font> 	pop r17
    <font CLASS=comment>81:</font> JM162A_Line0:
    <font CLASS=comment>82:</font> 	call JM162ASetDDRAMAddressF
    <font CLASS=comment>83:</font> ret
    <font CLASS=comment>84:</font> 
    <font CLASS=comment>85:</font> <font CLASS=comment>/*
    <font CLASS=comment>86:</font> 	R16:
    <font CLASS=comment>87:</font> 	 Bit(0): Entire shift ON(1)/OFF(0)
    <font CLASS=comment>88:</font> 	 Bit(1): Decrement(0)/Increment(1) mode
    <font CLASS=comment>89:</font> */</font>
    <font CLASS=comment>90:</font> JM162AEntryModeSetF: ;<font CLASS=symbols>+</font>
    <font CLASS=comment>91:</font> 	push r16
    <font CLASS=comment>92:</font> 	sbr r16, <font CLASS=integer>4</font>
    <font CLASS=comment>93:</font> 	andi r16, 0b00000111
    <font CLASS=comment>94:</font> 	call JM162ASendByteF
    <font CLASS=comment>95:</font> 	pop r16
    <font CLASS=comment>96:</font> ret
    <font CLASS=comment>97:</font> 
    <font CLASS=comment>98:</font> <font CLASS=comment>/*
    <font CLASS=comment>99:</font> 	R16:
   <font CLASS=comment>100:</font> 	 Bit(0): Blink ON(1)/OFF(0)
   <font CLASS=comment>101:</font> 	 Bit(1): Cursor ON(1)/OFF(0)
   <font CLASS=comment>102:</font> 	 Bit(2): Display ON(1)/OFF(0)
   <font CLASS=comment>103:</font> */</font>
   <font CLASS=comment>104:</font> JM162ADisplay_ON_OFF_ControlF: ;<font CLASS=symbols>+</font>
   <font CLASS=comment>105:</font> 	push r16
   <font CLASS=comment>106:</font> 	sbr R16, <font CLASS=integer>8</font>
   <font CLASS=comment>107:</font> 	andi R16, 0b00001111
   <font CLASS=comment>108:</font> 	call JM162ASendByteF
   <font CLASS=comment>109:</font> 	pop r16
   <font CLASS=comment>110:</font> ret
   <font CLASS=comment>111:</font> 
   <font CLASS=comment>112:</font> <font CLASS=comment>/*
   <font CLASS=comment>113:</font> 	R16:
   <font CLASS=comment>114:</font> 	 Bit(2):
   <font CLASS=comment>115:</font> 	 Bit(3):
   <font CLASS=comment>116:</font> */</font>
   <font CLASS=comment>117:</font> JM162ACursorOrDisplayShiftF:
   <font CLASS=comment>118:</font> 	sbr r16, <font CLASS=integer>16</font>
   <font CLASS=comment>119:</font> 	andi r16, 0b00011100
   <font CLASS=comment>120:</font> 	call JM162ASendByteF
   <font CLASS=comment>121:</font> ret
   <font CLASS=comment>122:</font> 
   <font CLASS=comment>123:</font> <font CLASS=comment>/*
   <font CLASS=comment>124:</font> 	R16:
   <font CLASS=comment>125:</font> 	 Bit(2): 5x8(0) or 5x11(1) Dots
   <font CLASS=comment>126:</font> 	 Bit(3): 1(0) or 2(1) - line mode
   <font CLASS=comment>127:</font> 	 Bit(4): 4(0) or 8(1) bit interface
   <font CLASS=comment>128:</font> */</font>
   <font CLASS=comment>129:</font> JM162AFunctionSetF:
   <font CLASS=comment>130:</font> 	sbr r16, <font CLASS=integer>32</font>
   <font CLASS=comment>131:</font> 	andi r16, 0b00111100
   <font CLASS=comment>132:</font> 	call JM162ASendByteF
   <font CLASS=comment>133:</font> ret
   <font CLASS=comment>134:</font> 
   <font CLASS=comment>135:</font> <font CLASS=comment>//	R16 - Addres</font>
   <font CLASS=comment>136:</font> JM162ASetDDRAMAddressF:
   <font CLASS=comment>137:</font> 	push r16
   <font CLASS=comment>138:</font> 	sbr r16, <font CLASS=integer>128</font>
   <font CLASS=comment>139:</font> 	call JM162ASendByteF
   <font CLASS=comment>140:</font> 	pop r16
   <font CLASS=comment>141:</font> ret
   <font CLASS=comment>142:</font> 
   <font CLASS=comment>143:</font> <font CLASS=comment>//	R16 - Data</font>
   <font CLASS=comment>144:</font> JM162AWriteDataToRAM:
   <font CLASS=comment>145:</font> 	sbi LCD_PORTx, LCD_RS
   <font CLASS=comment>146:</font> 	call JM162ASendByteF
   <font CLASS=comment>147:</font> ret
   <font CLASS=comment>148:</font> 
   <font CLASS=comment>149:</font> JM162ASendByteF: ;<font CLASS=symbols>+</font>
   <font CLASS=comment>150:</font> 	push r16
   <font CLASS=comment>151:</font> 	push r17
   <font CLASS=comment>152:</font> 
   <font CLASS=comment>153:</font> 	swap r16
   <font CLASS=comment>154:</font> 	call JM162AWriteToPortF
   <font CLASS=comment>155:</font> 	swap r16
   <font CLASS=comment>156:</font> 	call JM162AWriteToPortF
   <font CLASS=comment>157:</font> 
   <font CLASS=comment>158:</font> 	ldi r16, JM162A_DELAY_TIME
   <font CLASS=comment>159:</font> 	call DelayUsF
   <font CLASS=comment>160:</font> 
   <font CLASS=comment>161:</font> 	in r16, LCD_PORTx
   <font CLASS=comment>162:</font> 	andi r16, (<font CLASS=integer>1</font>&lt;&lt;LCD_PORTx_FREE_PIN)
   <font CLASS=comment>163:</font> 	out LCD_PORTx, R16
   <font CLASS=comment>164:</font> 	
   <font CLASS=comment>165:</font> 	pop r17
   <font CLASS=comment>166:</font> 	pop r16
   <font CLASS=comment>167:</font> ret
   <font CLASS=comment>168:</font> 
   <font CLASS=comment>169:</font> 
   <font CLASS=comment>170:</font> JM162AWriteToPortF:
   <font CLASS=comment>171:</font> 	push r16
   <font CLASS=comment>172:</font> 
   <font CLASS=comment>173:</font> 	andi r16, 0x0F
   <font CLASS=comment>174:</font> 	in r17, LCD_PORTx
   <font CLASS=comment>175:</font> 	andi r17, (<font CLASS=integer>1</font>&lt;&lt;LCD_PORTx_FREE_PIN)<font CLASS=symbols>|</font>(<font CLASS=integer>1</font>&lt;&lt;LCD_RS)<font CLASS=symbols>|</font>(<font CLASS=integer>1</font>&lt;&lt;LCD_RW)
   <font CLASS=comment>176:</font> 
   <font CLASS=comment>177:</font> 	or r16, r17
   <font CLASS=comment>178:</font> 	out LCD_PORTx, r16
   <font CLASS=comment>179:</font> 
   <font CLASS=comment>180:</font> 	sbi LCD_PORTx, LCD_E
   <font CLASS=comment>181:</font> 	nop
   <font CLASS=comment>182:</font> 	nop
   <font CLASS=comment>183:</font> 	cbi LCD_PORTx, LCD_E
   <font CLASS=comment>184:</font> 
   <font CLASS=comment>185:</font> 	pop r16
   <font CLASS=comment>186:</font> ret
   <font CLASS=comment>187:</font> 
   <font CLASS=comment>188:</font> <font CLASS=comment>/*
   <font CLASS=comment>189:</font> JM162WaitBusyF:
   <font CLASS=comment>190:</font> 	push r16
   <font CLASS=comment>191:</font> JM162AWaitBusyLoop:
   <font CLASS=comment>192:</font> 	call JM162AReadBusyFlagAndAddressCounterF
   <font CLASS=comment>193:</font> 	sbrc r16, 7
   <font CLASS=comment>194:</font> jmp JM162AWaitBusyLoop
   <font CLASS=comment>195:</font> 	pop r16
   <font CLASS=comment>196:</font> ret
   <font CLASS=comment>197:</font> 
   <font CLASS=comment>198:</font> JM162AReadBusyFlagAndAddressCounterF:
   <font CLASS=comment>199:</font> 	push r17
   <font CLASS=comment>200:</font> 
   <font CLASS=comment>201:</font> 	in r16, LCD_DDRx
   <font CLASS=comment>202:</font> 	andi r16, 0b10110000
   <font CLASS=comment>203:</font> 	out LCD_DDRx, r16
   <font CLASS=comment>204:</font> 
   <font CLASS=comment>205:</font> 	
   <font CLASS=comment>206:</font> 	call JM162AReadPortF
   <font CLASS=comment>207:</font> 	mov r17, r16
   <font CLASS=comment>208:</font> 	swap r17
   <font CLASS=comment>209:</font> 	call JM162AReadPortF
   <font CLASS=comment>210:</font> 	or r16, r17
   <font CLASS=comment>211:</font> 
   <font CLASS=comment>212:</font> 	in r17, LCD_DDRx
   <font CLASS=comment>213:</font> 	ori r17, 0x7f
   <font CLASS=comment>214:</font> 	out LCD_DDRx, r17
   <font CLASS=comment>215:</font> 	pop r17	
   <font CLASS=comment>216:</font> ret
   <font CLASS=comment>217:</font> 
   <font CLASS=comment>218:</font> JM162AReadPortF:
   <font CLASS=comment>219:</font> 	sbi LCD_PORTx, LCD_E
   <font CLASS=comment>220:</font> 	in r16, LCD_PINx
   <font CLASS=comment>221:</font> 	andi r16, 0x0f
   <font CLASS=comment>222:</font> 	nop
   <font CLASS=comment>223:</font> 	cbi LCD_PORTx, LCD_E
   <font CLASS=comment>224:</font> ret
   <font CLASS=comment>225:</font> */</font>
   <font CLASS=comment>226:</font> <font CLASS=comment>#endif</font>
   <font CLASS=comment>227:</font> 


</pre>

</div>


</body>
</html>
