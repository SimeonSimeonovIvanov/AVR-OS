<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<!--
Syntax highlighting generated by Web C Plus Plus software v0.8.4
Webcpp Copyright (C)2001-2004 Jeffrey Bakker under the GNU GPL
Get webcpp at http://webcpp.sf.net
-->

<html>
<head>
<title>display.inc</title>
<style type="text/css">

/*
Webcpp v0.8.1 compatible StyleSheet
http://webcpp.sf.net
Theme: typical
*/

body
{
background-color: #f9f9f9
}

.webcpp a:link    {color:#00b800}
.webcpp a:visited {color:#666666}
.webcpp a:active  {color:#224fff}
.webcpp a:hover   {color:#a900a9}

.webcpp pre
{
color: #000000
}

.webcpp font
{
font-size:100%
}

.webcpp .symbols
{
color: #0077dd
}

.webcpp .preproc
{
color: #a900a9
}

.webcpp .integer
{
color: #ff0032
}

.webcpp .floatpt
{
color: #ff23a6
}

.webcpp .dblquot
{
color: #00b800
}

.webcpp .sinquot
{
color: #00b86b
}

.webcpp .keyword
{
color: #224fff;
font-weight: bold
}

.webcpp .keytype
{
color: #ff9933;
font-weight: bold
}

.webcpp .comment
{
color: #666666;
font-style: italic
}

</style>
</head>
<body>

<div class="webcpp">
<pre>
     <font CLASS=comment>1:</font> <font CLASS=comment>/*
     <font CLASS=comment>2:</font> 	      The^day^of^DooM
     <font CLASS=comment>3:</font> 
     <font CLASS=comment>4:</font> 	Create date:   19.05.2006
     <font CLASS=comment>5:</font> 	Last Update:   05.07.2006
     <font CLASS=comment>6:</font> */</font>
     <font CLASS=comment>7:</font> 
     <font CLASS=comment>8:</font> <font CLASS=comment>#if DISPLAY_TYPE == JM162A</font>
     <font CLASS=comment>9:</font> 	.<font CLASS=keyword>include</font> <font CLASS=dblquot>"<a href="jm162a/jm162a.inc.html">scr/drivers/display/jm162a/jm162a.inc</a>"</font>
    <font CLASS=comment>10:</font> <font CLASS=comment>#endif</font>
    <font CLASS=comment>11:</font> 
    <font CLASS=comment>12:</font> <font CLASS=comment>#if DISPLAY_TYPE == JM162B</font>
    <font CLASS=comment>13:</font> <font CLASS=comment>#endif</font>
    <font CLASS=comment>14:</font> 
    <font CLASS=comment>15:</font> OSDisplayInitF:
    <font CLASS=comment>16:</font> 	clr r16
    <font CLASS=comment>17:</font> 	sts OSDisplayStatus, r16
    <font CLASS=comment>18:</font> 	sts OSDisplayX, r16
    <font CLASS=comment>19:</font> 	sts OSDisplayY, r16
    <font CLASS=comment>20:</font> <font CLASS=comment>#if DISPLAY_TYPE == JM162A</font>
    <font CLASS=comment>21:</font> 	call JM162AInitF
    <font CLASS=comment>22:</font> <font CLASS=comment>#endif</font>
    <font CLASS=comment>23:</font> ret
    <font CLASS=comment>24:</font> 
    <font CLASS=comment>25:</font> <font CLASS=comment>/*
    <font CLASS=comment>26:</font> 	ZH:ZL - Адреса на низа в FLASH-a
    <font CLASS=comment>27:</font> */</font>
    <font CLASS=comment>28:</font> OSDisplayPutStrF:
    <font CLASS=comment>29:</font> 	push r16
    <font CLASS=comment>30:</font> 	push ZL
    <font CLASS=comment>31:</font> 	push ZH
    <font CLASS=comment>32:</font> 
    <font CLASS=comment>33:</font>   OSPutStr_loop:
    <font CLASS=comment>34:</font>   	lpm r16, Z<font CLASS=symbols>+</font>
    <font CLASS=comment>35:</font> 	tst r16	
    <font CLASS=comment>36:</font>   	breq OSPutStrRet
    <font CLASS=comment>37:</font> 	call OSDisplayPutCharF
    <font CLASS=comment>38:</font>   jmp OSPutStr_loop
    <font CLASS=comment>39:</font> 
    <font CLASS=comment>40:</font> OSPutStrRet:
    <font CLASS=comment>41:</font> 	pop ZH
    <font CLASS=comment>42:</font> 	pop ZL
    <font CLASS=comment>43:</font> 	pop r16
    <font CLASS=comment>44:</font> ret
    <font CLASS=comment>45:</font> 
    <font CLASS=comment>46:</font> <font CLASS=comment>/*
    <font CLASS=comment>47:</font> 	R16 - Знака който ще извеждаме
    <font CLASS=comment>48:</font> */</font>
    <font CLASS=comment>49:</font> OSDisplayPutCharF:
    <font CLASS=comment>50:</font> 	push r16
    <font CLASS=comment>51:</font> 	push r17
    <font CLASS=comment>52:</font> 	push r16
    <font CLASS=comment>53:</font> <font CLASS=comment>// --------------------------------------------------------------------------</font>
    <font CLASS=comment>54:</font> <font CLASS=comment>/*
    <font CLASS=comment>55:</font> 	OSDisplayStatus приема за стойност:
    <font CLASS=comment>56:</font> 		0 - Означава, дисплея е свободен
    <font CLASS=comment>57:</font> 		Номера на процеса който го е резервирал
    <font CLASS=comment>58:</font> 
    <font CLASS=comment>59:</font> 	В случей, че е нула OSDisplayStatus=OSGetNumberOfCurrentTask
    <font CLASS=comment>60:</font> 	Ако е по голям от нула ще позволи използване на функцията само
    <font CLASS=comment>61:</font> 	при условие, че е извикана от процес с номер равен на OSDisplayStatus
    <font CLASS=comment>62:</font> */</font>
    <font CLASS=comment>63:</font>   OSPutCharWaitForFreeDisplay:
    <font CLASS=comment>64:</font>   	cli
    <font CLASS=comment>65:</font>   	lds r17, OSDisplayStatus
    <font CLASS=comment>66:</font> 	OSGetNumberOfCurrentTask r16
    <font CLASS=comment>67:</font> 	<font CLASS=comment>/* Може би е зает от текущия процес? */</font>
    <font CLASS=comment>68:</font> 	cp r16, r17
    <font CLASS=comment>69:</font> 	breq OSPutCharDisplayIsFree
    <font CLASS=comment>70:</font> 	
    <font CLASS=comment>71:</font> 	<font CLASS=comment>/* Може би пък е свободен? */</font>
    <font CLASS=comment>72:</font> 	tst r17
    <font CLASS=comment>73:</font> 	breq OSPutCharDisplayIsFree
    <font CLASS=comment>74:</font> 	sei
    <font CLASS=comment>75:</font>   jmp OSPutCharWaitForFreeDisplay
    <font CLASS=comment>76:</font> 
    <font CLASS=comment>77:</font> OSPutCharDisplayIsFree:
    <font CLASS=comment>78:</font> 	sts OSDisplayStatus, r16 ; Записваме кой процес е окупирал дисплея
    <font CLASS=comment>79:</font> 	sei
    <font CLASS=comment>80:</font> <font CLASS=comment>// --------------------------------------------------------------------------</font>
    <font CLASS=comment>81:</font> <font CLASS=comment>/*
    <font CLASS=comment>82:</font> 	gotoxy(x,y);
    <font CLASS=comment>83:</font> 	putchar(ch);
    <font CLASS=comment>84:</font> 
    <font CLASS=comment>85:</font> 	if(++x&gt;=16) {
    <font CLASS=comment>86:</font> 		x=0;
    <font CLASS=comment>87:</font> 		y++;
    <font CLASS=comment>88:</font> 	}
    <font CLASS=comment>89:</font> 
    <font CLASS=comment>90:</font> 	if(y&gt;=2) {
    <font CLASS=comment>91:</font> 		x=0;
    <font CLASS=comment>92:</font> 		y=0;
    <font CLASS=comment>93:</font> 		clrscr();
    <font CLASS=comment>94:</font> 	}
    <font CLASS=comment>95:</font> */</font>
    <font CLASS=comment>96:</font> 
    <font CLASS=comment>97:</font> <font CLASS=comment>#if DISPLAY_TYPE == UNKNOWN_DISPLEY_TYPE</font>
    <font CLASS=comment>98:</font> 	pop r16
    <font CLASS=comment>99:</font> <font CLASS=comment>#endif</font>
   <font CLASS=comment>100:</font> 
   <font CLASS=comment>101:</font> <font CLASS=comment>#if DISPLAY_TYPE == JM162A</font>
   <font CLASS=comment>102:</font> 	lds r16, OSDisplayX
   <font CLASS=comment>103:</font> 	lds r17, OSDisplayY
   <font CLASS=comment>104:</font> 	call JM162AGoToXYF ; gotoxy(r16,r17)
   <font CLASS=comment>105:</font> <font CLASS=comment>#endif</font>
   <font CLASS=comment>106:</font> 	pop r16
   <font CLASS=comment>107:</font> <font CLASS=comment>#if DISPLAY_TYPE == JM162A</font>
   <font CLASS=comment>108:</font> 	call JM162AWriteDataToRAM ; putchar(r16)
   <font CLASS=comment>109:</font> 	lds r16, OSDisplayX
   <font CLASS=comment>110:</font> <font CLASS=comment>#endif</font>
   <font CLASS=comment>111:</font> 
   <font CLASS=comment>112:</font> <font CLASS=comment>#if DISPLAY_TYPE != UNKNOWN_DISPLEY_TYPE</font>
   <font CLASS=comment>113:</font> 	inc r16
   <font CLASS=comment>114:</font> 	cpi r16, DISPLEY_X_SIZE
   <font CLASS=comment>115:</font> 	brlo L01
   <font CLASS=comment>116:</font> 	inc r17
   <font CLASS=comment>117:</font> 	clr r16
   <font CLASS=comment>118:</font> L0<font CLASS=integer>1</font>:
   <font CLASS=comment>119:</font> 	cpi r17, DISPLEY_Y_SIZE
   <font CLASS=comment>120:</font> 	brlo L02
   <font CLASS=comment>121:</font> 	clr r16
   <font CLASS=comment>122:</font> 	clr r17
   <font CLASS=comment>123:</font> 	OSDisplayClear ; clrscr()
   <font CLASS=comment>124:</font> L0<font CLASS=integer>2</font>:
   <font CLASS=comment>125:</font> 	sts OSDisplayX, r16
   <font CLASS=comment>126:</font> 	sts OSDisplayY, r17
   <font CLASS=comment>127:</font> <font CLASS=comment>#endif</font>
   <font CLASS=comment>128:</font> <font CLASS=comment>// -----------------------------------------</font>
   <font CLASS=comment>129:</font> 	pop r17
   <font CLASS=comment>130:</font> 	pop r16
   <font CLASS=comment>131:</font> ret
   <font CLASS=comment>132:</font> 


</pre>

</div>


</body>
</html>