<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<!--
Syntax highlighting generated by Web C Plus Plus software v0.8.4
Webcpp Copyright (C)2001-2004 Jeffrey Bakker under the GNU GPL
Get webcpp at http://webcpp.sf.net
-->

<html>
<head>
<title>task.inc</title>
<style type="text/css">

/*
Webcpp v0.8.1 compatible StyleSheet
http://webcpp.sf.net
Theme: typical
*/

body
{
background-color: #f9f9f9
}

.webcpp a:link    {color:#00b800}
.webcpp a:visited {color:#666666}
.webcpp a:active  {color:#224fff}
.webcpp a:hover   {color:#a900a9}

.webcpp pre
{
color: #000000
}

.webcpp font
{
font-size:100%
}

.webcpp .symbols
{
color: #0077dd
}

.webcpp .preproc
{
color: #a900a9
}

.webcpp .integer
{
color: #ff0032
}

.webcpp .floatpt
{
color: #ff23a6
}

.webcpp .dblquot
{
color: #00b800
}

.webcpp .sinquot
{
color: #00b86b
}

.webcpp .keyword
{
color: #224fff;
font-weight: bold
}

.webcpp .keytype
{
color: #ff9933;
font-weight: bold
}

.webcpp .comment
{
color: #666666;
font-style: italic
}

</style>
</head>
<body>

<div class="webcpp">
<pre>

     <font CLASS=comment>1:</font> <font CLASS=comment>/*
     <font CLASS=comment>2:</font> 	      The^day^of^DooM
     <font CLASS=comment>3:</font> 
     <font CLASS=comment>4:</font> 	Create date:   30.04.2006
     <font CLASS=comment>5:</font> 	Last Update:   21.07.2006
     <font CLASS=comment>6:</font> */</font>
     <font CLASS=comment>7:</font> 
     <font CLASS=comment>8:</font> <font CLASS=comment>//------------------------------------------------------------------------------------</font>
     <font CLASS=comment>9:</font> OSTaskManagerF:
    <font CLASS=comment>10:</font> 	cli
    <font CLASS=comment>11:</font> 	OSStopTimer
    <font CLASS=comment>12:</font> <font CLASS=comment>// - - - - - OSSaveCurrentTask - - - - - -</font>
    <font CLASS=comment>13:</font> 	push r0
    <font CLASS=comment>14:</font> 	push r1
    <font CLASS=comment>15:</font> 	push r2
    <font CLASS=comment>16:</font> 	push r3
    <font CLASS=comment>17:</font> 	push r4
    <font CLASS=comment>18:</font> 	push r5
    <font CLASS=comment>19:</font> 	push r6
    <font CLASS=comment>20:</font> 	push r7
    <font CLASS=comment>21:</font> 	push r8
    <font CLASS=comment>22:</font> 	push r9
    <font CLASS=comment>23:</font> 	push r10
    <font CLASS=comment>24:</font> 	push r11
    <font CLASS=comment>25:</font> 	push r12
    <font CLASS=comment>26:</font> 	push r13
    <font CLASS=comment>27:</font> 	push r14
    <font CLASS=comment>28:</font> 	push r15
    <font CLASS=comment>29:</font> 	push r16
    <font CLASS=comment>30:</font> 	push r17
    <font CLASS=comment>31:</font> 	push r18
    <font CLASS=comment>32:</font> 	push r19
    <font CLASS=comment>33:</font> 	push r20
    <font CLASS=comment>34:</font> 	push r21
    <font CLASS=comment>35:</font> 	push r22
    <font CLASS=comment>36:</font> 	push r23
    <font CLASS=comment>37:</font> 	push r24
    <font CLASS=comment>38:</font> 	push r25
    <font CLASS=comment>39:</font> 	push r26
    <font CLASS=comment>40:</font> 	push r27
    <font CLASS=comment>41:</font> 	push r28
    <font CLASS=comment>42:</font> 	push r29
    <font CLASS=comment>43:</font> 	push r30
    <font CLASS=comment>44:</font> 	push r31
    <font CLASS=comment>45:</font> 	in r16, sreg
    <font CLASS=comment>46:</font> 	push r16
    <font CLASS=comment>47:</font> 
    <font CLASS=comment>48:</font> 	OSGetNumberOfCurrentTask r16
    <font CLASS=comment>49:</font> 	call OSGetDisplacementOfTaskF
    <font CLASS=comment>50:</font> 	adiw ZH:ZL, <font CLASS=integer>1</font>
    <font CLASS=comment>51:</font> 	in r16, sph
    <font CLASS=comment>52:</font> 	st Z<font CLASS=symbols>+</font>, r16
    <font CLASS=comment>53:</font> 	in r16, spl
    <font CLASS=comment>54:</font> 	st Z<font CLASS=symbols>+</font>, r16
    <font CLASS=comment>55:</font> <font CLASS=comment>// - - - - - - - - - - - - - - - - - - - - -</font>
    <font CLASS=comment>56:</font>   OSTaskManagerPointOfFirstRun:
    <font CLASS=comment>57:</font>   OSTaskManagerPointOfExitFromTask:
    <font CLASS=comment>58:</font> 
    <font CLASS=comment>59:</font>   OSTaskManagerCrash:
    <font CLASS=comment>60:</font> 	lds r18, TASK_COUNTER
    <font CLASS=comment>61:</font> 	tst r18
    <font CLASS=comment>62:</font>   breq OSTaskManagerCrash
    <font CLASS=comment>63:</font> 
    <font CLASS=comment>64:</font> 	OSGetNumberOfCurrentTask r16
    <font CLASS=comment>65:</font> OSTaskManagerLoadNextTask:
    <font CLASS=comment>66:</font> 	inc r16
    <font CLASS=comment>67:</font> 	cp r18, r16
    <font CLASS=comment>68:</font> 	brlo OSTaskManagerGoToTaskOne
    <font CLASS=comment>69:</font>   
    <font CLASS=comment>70:</font>   	jmp OSTaskManagerRet
    <font CLASS=comment>71:</font> 
    <font CLASS=comment>72:</font>   OSTaskManagerGoToTaskOne:
    <font CLASS=comment>73:</font> 	ldi r16, <font CLASS=integer>1</font>
    <font CLASS=comment>74:</font>  
    <font CLASS=comment>75:</font>   OSTaskManagerRet:
    <font CLASS=comment>76:</font> 	OSSaveNumberOfCurrentTask r16
    <font CLASS=comment>77:</font> <font CLASS=comment>// - - - - - - - - - - - - - - - - - - - - -</font>
    <font CLASS=comment>78:</font> 	call OSGetDisplacementOfTaskF
    <font CLASS=comment>79:</font> 	ld r17, Z<font CLASS=symbols>+</font>
    <font CLASS=comment>80:</font> 	
    <font CLASS=comment>81:</font> 	cpi r17, TASK_IS_RUN
    <font CLASS=comment>82:</font> 	breq OSTaskManagerLoadTask
    <font CLASS=comment>83:</font> 	cpi r17, TASK_IS_STOP
    <font CLASS=comment>84:</font> 	breq OSTaskManagerLoadNextTask
    <font CLASS=comment>85:</font> 
    <font CLASS=comment>86:</font> OSTaskManagerLoadTask:
    <font CLASS=comment>87:</font> 	call OSInitTaskIRQF
    <font CLASS=comment>88:</font> <font CLASS=comment>// - - - - - - - - - - - - - - - - -</font>
    <font CLASS=comment>89:</font> 	ld r16, Z<font CLASS=symbols>+</font>
    <font CLASS=comment>90:</font> 	out sph, r16
    <font CLASS=comment>91:</font> 	ld r16, Z<font CLASS=symbols>+</font>
    <font CLASS=comment>92:</font> 	out spl, r16
    <font CLASS=comment>93:</font> <font CLASS=comment>// - - - - - - - - - - - - - - - - -</font>
    <font CLASS=comment>94:</font> 	ld r16, Z<font CLASS=symbols>+</font> <font CLASS=comment>// Load TCNTx</font>
    <font CLASS=comment>95:</font> 	ld r16, Z<font CLASS=symbols>+</font> <font CLASS=comment>// H:L</font>
    <font CLASS=comment>96:</font> 	out OCR0, r16 <font CLASS=comment>// Настроиваме таймера</font>
    <font CLASS=comment>97:</font> 	
    <font CLASS=comment>98:</font> 	pop r16
    <font CLASS=comment>99:</font> 	out sreg, r16
   <font CLASS=comment>100:</font> 	pop r31
   <font CLASS=comment>101:</font> 	pop r30
   <font CLASS=comment>102:</font> 	pop r29
   <font CLASS=comment>103:</font> 	pop r28
   <font CLASS=comment>104:</font> 	pop r27
   <font CLASS=comment>105:</font> 	pop r26
   <font CLASS=comment>106:</font> 	pop r25
   <font CLASS=comment>107:</font> 	pop r24
   <font CLASS=comment>108:</font> 	pop r23
   <font CLASS=comment>109:</font> 	pop r22
   <font CLASS=comment>110:</font> 	pop r21
   <font CLASS=comment>111:</font> 	pop r20
   <font CLASS=comment>112:</font> 	pop r19
   <font CLASS=comment>113:</font> 	pop r18
   <font CLASS=comment>114:</font> 	pop r17
   <font CLASS=comment>115:</font> 	pop r16
   <font CLASS=comment>116:</font> 	pop r15
   <font CLASS=comment>117:</font> 	pop r14
   <font CLASS=comment>118:</font> 	pop r13
   <font CLASS=comment>119:</font> 	pop r12
   <font CLASS=comment>120:</font> 	pop r11
   <font CLASS=comment>121:</font> 	pop r10
   <font CLASS=comment>122:</font> 	pop r9
   <font CLASS=comment>123:</font> 	pop r8
   <font CLASS=comment>124:</font> 	pop r7
   <font CLASS=comment>125:</font> 	pop r6
   <font CLASS=comment>126:</font> 	pop r5
   <font CLASS=comment>127:</font> 	pop r4
   <font CLASS=comment>128:</font> 	pop r3
   <font CLASS=comment>129:</font> 	pop r2
   <font CLASS=comment>130:</font> 	pop r1
   <font CLASS=comment>131:</font> 	pop r0
   <font CLASS=comment>132:</font> <font CLASS=comment>// - - - - - - - - - - - - - - - - - - - - -</font>
   <font CLASS=comment>133:</font>   	OSRunTimer
   <font CLASS=comment>134:</font>   reti <font CLASS=comment>// Изпразваме стека като прескачаме на текущия процес</font>
   <font CLASS=comment>135:</font> <font CLASS=comment>//------------------------------------------------------------------------------------</font>
   <font CLASS=comment>136:</font> <font CLASS=comment>/*
   <font CLASS=comment>137:</font> 	X - Адреса на процеса
   <font CLASS=comment>138:</font> 	Y - Брой на машини цикли за изпълнение
   <font CLASS=comment>139:</font> */</font>
   <font CLASS=comment>140:</font> OSCreateTaskF:
   <font CLASS=comment>141:</font> 	cli
   <font CLASS=comment>142:</font> 	push r16
   <font CLASS=comment>143:</font> 	push r17
   <font CLASS=comment>144:</font> 	push r18
   <font CLASS=comment>145:</font> 	push r19
   <font CLASS=comment>146:</font> 	push ZL
   <font CLASS=comment>147:</font> 	push ZH
   <font CLASS=comment>148:</font> 
   <font CLASS=comment>149:</font> 	lds r16, TASK_COUNTER
   <font CLASS=comment>150:</font> 	inc r16
   <font CLASS=comment>151:</font> 	sts TASK_COUNTER, r16
   <font CLASS=comment>152:</font> <font CLASS=comment>// --------------------------------------</font>
   <font CLASS=comment>153:</font> <font CLASS=comment>//    Насочваме стековия оказатела на</font>
   <font CLASS=comment>154:</font> <font CLASS=comment>//  на процеса към стека му, като</font>
   <font CLASS=comment>155:</font> <font CLASS=comment>//  сме се съобразили с това, че имаме</font>
   <font CLASS=comment>156:</font> <font CLASS=comment>//  33 регистъра + адрес на процеса</font>
   <font CLASS=comment>157:</font> 	call OSGetDisplacementOfTaskF
   <font CLASS=comment>158:</font> 	clr r16 ; TASK_IS_RUN
   <font CLASS=comment>159:</font> 	st Z<font CLASS=symbols>+</font>, r16
   <font CLASS=comment>160:</font> 
   <font CLASS=comment>161:</font> 	movw r19:r18, ZH:ZL
   <font CLASS=comment>162:</font> 	ldi r17, SIZE_OF_TASK_STRUCTURE<font CLASS=symbols>-</font><font CLASS=integer>37</font>
   <font CLASS=comment>163:</font> 	add r18, r17
   <font CLASS=comment>164:</font> 	clr r17
   <font CLASS=comment>165:</font> 	adc r19, r17
   <font CLASS=comment>166:</font> 
   <font CLASS=comment>167:</font> 	st Z<font CLASS=symbols>+</font>, r19 <font CLASS=comment>// SPH</font>
   <font CLASS=comment>168:</font> 	st Z<font CLASS=symbols>+</font>, r18 <font CLASS=comment>// SPL</font>
   <font CLASS=comment>169:</font> <font CLASS=comment>// --------------------------------------</font>
   <font CLASS=comment>170:</font> 	st Z<font CLASS=symbols>+</font>, YH <font CLASS=comment>// Брой на машини цикли за</font>
   <font CLASS=comment>171:</font> 	st Z<font CLASS=symbols>+</font>, YL <font CLASS=comment>// изпълнение на процеса</font>
   <font CLASS=comment>172:</font> <font CLASS=comment>// --------------------------------------</font>
   <font CLASS=comment>173:</font> <font CLASS=comment>//   В самия край на паметта заделена за</font>
   <font CLASS=comment>174:</font> <font CLASS=comment>//  процеса (в частност областа на стека)</font>
   <font CLASS=comment>175:</font> <font CLASS=comment>//  записваме адреса на процеса</font>
   <font CLASS=comment>176:</font> 	subi ZH:ZL, <font CLASS=integer>4</font>
   <font CLASS=comment>177:</font> 	ldi r17, SIZE_OF_TASK_STRUCTURE<font CLASS=symbols>-</font><font CLASS=integer>3</font>
   <font CLASS=comment>178:</font> 	add ZL, r17
   <font CLASS=comment>179:</font> 	clr r17
   <font CLASS=comment>180:</font> 	adc ZH, r17
   <font CLASS=comment>181:</font> 	
   <font CLASS=comment>182:</font> 	st Z<font CLASS=symbols>+</font>, XH
   <font CLASS=comment>183:</font> 	st Z<font CLASS=symbols>+</font>, XL
   <font CLASS=comment>184:</font> 	subi ZH:ZL, <font CLASS=integer>2</font>
   <font CLASS=comment>185:</font> <font CLASS=comment>// --------------------------------------</font>
   <font CLASS=comment>186:</font> <font CLASS=comment>// 	 Нулираме регистрите (чрез нулиране</font>
   <font CLASS=comment>187:</font> <font CLASS=comment>//	на самия стек). Също се нулира и</font>
   <font CLASS=comment>188:</font> <font CLASS=comment>//	таблицата на прекъсванията.</font>
   <font CLASS=comment>189:</font> 	ldi r17, SIZE_OF_TASK_STRUCTURE<font CLASS=symbols>-</font><font CLASS=integer>8</font>
   <font CLASS=comment>190:</font>   OSCreateTask_loop:
   <font CLASS=comment>191:</font> 	st -Z, r16
   <font CLASS=comment>192:</font> 	dec r17
   <font CLASS=comment>193:</font> 	tst r17
   <font CLASS=comment>194:</font>   brne OSCreateTask_loop
   <font CLASS=comment>195:</font> <font CLASS=comment>// --------------------------------------	</font>
   <font CLASS=comment>196:</font> 	pop ZH
   <font CLASS=comment>197:</font> 	pop ZL
   <font CLASS=comment>198:</font> 	pop r19
   <font CLASS=comment>199:</font> 	pop r18
   <font CLASS=comment>200:</font> 	pop r17
   <font CLASS=comment>201:</font> 	pop r16
   <font CLASS=comment>202:</font> ret
   <font CLASS=comment>203:</font> <font CLASS=comment>//------------------------------------------------------------------------------------</font>
   <font CLASS=comment>204:</font> <font CLASS=comment>/*
   <font CLASS=comment>205:</font> 	R16 - Номера на процеса който
   <font CLASS=comment>206:</font> 	      желаем да премахнем
   <font CLASS=comment>207:</font> */</font>
   <font CLASS=comment>208:</font> OSRemoveTaskF:
   <font CLASS=comment>209:</font> 	cli
   <font CLASS=comment>210:</font> 	push r16
   <font CLASS=comment>211:</font> 	push r17
   <font CLASS=comment>212:</font> 	push r18
   <font CLASS=comment>213:</font> 	push r19
   <font CLASS=comment>214:</font> 	push r20
   <font CLASS=comment>215:</font>  	push YL
   <font CLASS=comment>216:</font> 	push YH
   <font CLASS=comment>217:</font> 	push ZL
   <font CLASS=comment>218:</font> 	push ZH
   <font CLASS=comment>219:</font> 
   <font CLASS=comment>220:</font> 	clr r20
   <font CLASS=comment>221:</font> 	jmp OSExitFromTask01
   <font CLASS=comment>222:</font> OSExitFromTaskF:
   <font CLASS=comment>223:</font> 	cli
   <font CLASS=comment>224:</font> 	OSStopTimer
   <font CLASS=comment>225:</font> 	ldi r20, <font CLASS=integer>1</font>
   <font CLASS=comment>226:</font> 	ldi r16, high(OSSPH)
   <font CLASS=comment>227:</font> 	out sph, r16
   <font CLASS=comment>228:</font> 	ldi r16, low(OSSPL)
   <font CLASS=comment>229:</font> 	out spl, r16
   <font CLASS=comment>230:</font> 	OSGetNumberOfCurrentTask r16
   <font CLASS=comment>231:</font> OSExitFromTask01:
   <font CLASS=comment>232:</font> 	lds r17, TASK_COUNTER
   <font CLASS=comment>233:</font> 	
   <font CLASS=comment>234:</font> 	tst r17               <font CLASS=comment>// Ако броя на процеси е нула</font>
   <font CLASS=comment>235:</font> 	breq OSRemoveTaskRet  <font CLASS=comment>// излизаме директно от функцията</font>
   <font CLASS=comment>236:</font> 
   <font CLASS=comment>237:</font> 	cp r16, r17           <font CLASS=comment>// А може и да сме искали да махнем последния процес:</font>
   <font CLASS=comment>238:</font> 	breq OSRemoveLastTask <font CLASS=comment>// тогава просто има намаляме броя с едно</font>
   <font CLASS=comment>239:</font> 
   <font CLASS=comment>240:</font> 	cp r17, r16           <font CLASS=comment>// Може би пък сме задали не съществуващ процес?</font>
   <font CLASS=comment>241:</font> 	brlo OSRemoveTaskRet  <font CLASS=comment>//  (по-голям номер от текущия им брой)</font>
   <font CLASS=comment>242:</font> 	                      <font CLASS=comment>// Ами тогава веднага напускаме процедурата :)</font>
   <font CLASS=comment>243:</font> 
   <font CLASS=comment>244:</font> <font CLASS=comment>#ifdef DISPLAY</font>
   <font CLASS=comment>245:</font> 	OSSaveL r17
   <font CLASS=comment>246:</font> 	lds r17, OSDisplayStatus
   <font CLASS=comment>247:</font> 	cp r16, r17
   <font CLASS=comment>248:</font> 	brge L00
   <font CLASS=comment>249:</font> 	dec r17
   <font CLASS=comment>250:</font> 	sts OSDisplayStatus, r17
   <font CLASS=comment>251:</font> L0<font CLASS=integer>0</font>:
   <font CLASS=comment>252:</font> 	OSLoadL r17
   <font CLASS=comment>253:</font> <font CLASS=comment>#endif</font>
   <font CLASS=comment>254:</font> <font CLASS=comment>// - - - - - - - - - - - - - - - - - </font>
   <font CLASS=comment>255:</font>  OSRemoveTaskLoop:
   <font CLASS=comment>256:</font> 	call OSGetDisplacementOfTaskF
   <font CLASS=comment>257:</font> 	movw YL, ZL   <font CLASS=comment>// Y -&gt; task_1</font>
   <font CLASS=comment>258:</font> 	adiw ZH:ZL, <font CLASS=integer>1</font>
   <font CLASS=comment>259:</font> <font CLASS=comment>// - - - - - - - - - - - - - - - - -</font>
   <font CLASS=comment>260:</font> <font CLASS=comment>//	Настоящата част от кода се</font>
   <font CLASS=comment>261:</font> <font CLASS=comment>//	грижи да изчисли и запише новата</font>
   <font CLASS=comment>262:</font> <font CLASS=comment>//	стойност на SP на task_2.</font>
   <font CLASS=comment>263:</font> <font CLASS=comment>//	(SP-=SIZE_OF_TASK_STRUCTURE)</font>
   <font CLASS=comment>264:</font> 	inc r16
   <font CLASS=comment>265:</font> 	call OSGetDisplacementOfTaskF <font CLASS=comment>// Z -&gt; task_2</font>
   <font CLASS=comment>266:</font> 	adiw ZH:ZL, <font CLASS=integer>1</font>
   <font CLASS=comment>267:</font> 	ld r19, Z<font CLASS=symbols>+</font>
   <font CLASS=comment>268:</font> 	ld r18, Z<font CLASS=symbols>+</font>
   <font CLASS=comment>269:</font> 	subi r18, SIZE_OF_TASK_STRUCTURE
   <font CLASS=comment>270:</font> 	sbci r19, <font CLASS=integer>0</font>
   <font CLASS=comment>271:</font> 	
   <font CLASS=comment>272:</font> 	subi ZH:ZL, <font CLASS=integer>2</font>
   <font CLASS=comment>273:</font> 	st Z<font CLASS=symbols>+</font>, r19
   <font CLASS=comment>274:</font> 	st Z<font CLASS=symbols>+</font>, r18
   <font CLASS=comment>275:</font> 	subi ZH:ZL, <font CLASS=integer>3</font>
   <font CLASS=comment>276:</font> <font CLASS=comment>// - - - - - - - - - - - - - - - - - </font>
   <font CLASS=comment>277:</font> 	ldi r18, SIZE_OF_TASK_STRUCTURE
   <font CLASS=comment>278:</font>    OSRemoveTaskSwap:
   <font CLASS=comment>279:</font>     ld r19, Z<font CLASS=symbols>+</font>
   <font CLASS=comment>280:</font> 	st Y<font CLASS=symbols>+</font>, r19
   <font CLASS=comment>281:</font> 	dec r18
   <font CLASS=comment>282:</font>    brne OSRemoveTaskSwap
   <font CLASS=comment>283:</font> 
   <font CLASS=comment>284:</font>     cp r16, r17
   <font CLASS=comment>285:</font>  brne OSRemoveTaskLoop
   <font CLASS=comment>286:</font> <font CLASS=comment>// - - - - - - - - - - - - - - - - -</font>
   <font CLASS=comment>287:</font>  OSRemoveLastTask:
   <font CLASS=comment>288:</font> 	dec r17
   <font CLASS=comment>289:</font> 	sts TASK_COUNTER, r17
   <font CLASS=comment>290:</font> 	lds r16, CURRENT_TASK
   <font CLASS=comment>291:</font> 	tst r16
   <font CLASS=comment>292:</font> 	breq OSRemoveTaskRet
   <font CLASS=comment>293:</font> 
   <font CLASS=comment>294:</font> 	dec r16
   <font CLASS=comment>295:</font> 	cp r17, r16
   <font CLASS=comment>296:</font> 	brlo L1
   <font CLASS=comment>297:</font> 
   <font CLASS=comment>298:</font> 	jmp L2
   <font CLASS=comment>299:</font> L1:
   <font CLASS=comment>300:</font> 	clr r16
   <font CLASS=comment>301:</font> L2:
   <font CLASS=comment>302:</font> 	sts CURRENT_TASK, r16	
   <font CLASS=comment>303:</font>  OSRemoveTaskRet:
   <font CLASS=comment>304:</font> 	tst r20
   <font CLASS=comment>305:</font> 	breq OSExitFromTask02
   <font CLASS=comment>306:</font> 	jmp OSTaskManagerPointOfExitFromTask
   <font CLASS=comment>307:</font> OSExitFromTask02:
   <font CLASS=comment>308:</font> 	pop ZH
   <font CLASS=comment>309:</font> 	pop ZL
   <font CLASS=comment>310:</font> 	pop YH
   <font CLASS=comment>311:</font> 	pop YL
   <font CLASS=comment>312:</font> 	pop r20
   <font CLASS=comment>313:</font> 	pop r19
   <font CLASS=comment>314:</font> 	pop r18
   <font CLASS=comment>315:</font> 	pop r17
   <font CLASS=comment>316:</font> 	pop r16
   <font CLASS=comment>317:</font> ret
   <font CLASS=comment>318:</font> <font CLASS=comment>//------------------------------------------------------------------------------------</font>
   <font CLASS=comment>319:</font> <font CLASS=comment>/*
   <font CLASS=comment>320:</font> 	R16   - Номера на процеса
   <font CLASS=comment>321:</font> 	XH:ZL - Новия приоритет на процеса
   <font CLASS=comment>322:</font> */</font>
   <font CLASS=comment>323:</font> OSChangeTaskPriorityF:
   <font CLASS=comment>324:</font> 	cli
   <font CLASS=comment>325:</font> 	push ZL
   <font CLASS=comment>326:</font> 	push ZH
   <font CLASS=comment>327:</font> 	call OSGetDisplacementOfTaskF
   <font CLASS=comment>328:</font> 	adiw ZH:ZL, <font CLASS=integer>2</font>
   <font CLASS=comment>329:</font> 	st Z<font CLASS=symbols>+</font>, XH
   <font CLASS=comment>330:</font> 	st Z<font CLASS=symbols>+</font>, XL
   <font CLASS=comment>331:</font> 	pop ZH
   <font CLASS=comment>332:</font> 	pop ZL
   <font CLASS=comment>333:</font> ret
   <font CLASS=comment>334:</font> <font CLASS=comment>//------------------------------------------------------------------------------------</font>
   <font CLASS=comment>335:</font> <font CLASS=comment>/*
   <font CLASS=comment>336:</font> 	R16 - Номер на процеса
   <font CLASS=comment>337:</font> 	retutn:
   <font CLASS=comment>338:</font> 		Z - Отместването на процеса
   <font CLASS=comment>339:</font> */</font>
   <font CLASS=comment>340:</font> OSGetDisplacementOfTaskF:
   <font CLASS=comment>341:</font> 	push r0
   <font CLASS=comment>342:</font> 	push r1
   <font CLASS=comment>343:</font> 	push r16
   <font CLASS=comment>344:</font> 
   <font CLASS=comment>345:</font> 	ldi ZL, SIZE_OF_TASK_STRUCTURE
   <font CLASS=comment>346:</font> 	mul r16, ZL
   <font CLASS=comment>347:</font> 
   <font CLASS=comment>348:</font> 	movw ZL, r0
   <font CLASS=comment>349:</font> 	subi ZH:ZL, <font CLASS=preproc>$<font CLASS=integer>3</font>	</font>
   <font CLASS=comment>350:</font> 	pop r16
   <font CLASS=comment>351:</font> 	pop r1
   <font CLASS=comment>352:</font> 	pop r0
   <font CLASS=comment>353:</font> ret
   <font CLASS=comment>354:</font> <font CLASS=comment>//------------------------------------------------------------------------------------</font>
   <font CLASS=comment>355:</font> 


</pre>

</div>


</body>
</html>
