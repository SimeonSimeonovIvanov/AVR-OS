<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<!--
Syntax highlighting generated by Web C Plus Plus software v0.8.4
Webcpp Copyright (C)2001-2004 Jeffrey Bakker under the GNU GPL
Get webcpp at http://webcpp.sf.net
-->

<html>
<head>
<title>irq.inc</title>
<style type="text/css">

/*
Webcpp v0.8.1 compatible StyleSheet
http://webcpp.sf.net
Theme: typical
*/

body
{
background-color: #f9f9f9
}

.webcpp a:link    {color:#00b800}
.webcpp a:visited {color:#666666}
.webcpp a:active  {color:#224fff}
.webcpp a:hover   {color:#a900a9}

.webcpp pre
{
color: #000000
}

.webcpp font
{
font-size:100%
}

.webcpp .symbols
{
color: #0077dd
}

.webcpp .preproc
{
color: #a900a9
}

.webcpp .integer
{
color: #ff0032
}

.webcpp .floatpt
{
color: #ff23a6
}

.webcpp .dblquot
{
color: #00b800
}

.webcpp .sinquot
{
color: #00b86b
}

.webcpp .keyword
{
color: #224fff;
font-weight: bold
}

.webcpp .keytype
{
color: #ff9933;
font-weight: bold
}

.webcpp .comment
{
color: #666666;
font-style: italic
}

</style>
</head>
<body>

<div class="webcpp">
<pre>

     <font CLASS=comment>1:</font> <font CLASS=comment>/*
     <font CLASS=comment>2:</font> 	      The^day^of^DooM
     <font CLASS=comment>3:</font> 
     <font CLASS=comment>4:</font> 	Create date:   30.04.2006
     <font CLASS=comment>5:</font> 	Last Update:   19.06.2006
     <font CLASS=comment>6:</font> 
     <font CLASS=comment>7:</font> 				Структура на таблицата на прекъсванията:
     <font CLASS=comment>8:</font> 
     <font CLASS=comment>9:</font> 		4 байта таблица
    <font CLASS=comment>10:</font> 		2 байта адрес на обработващата подпрограма
    <font CLASS=comment>11:</font> 		------------------------------------------
    <font CLASS=comment>12:</font> 		БАЙТ_3
    <font CLASS=comment>13:</font> 		БАЙТ_2
    <font CLASS=comment>14:</font> 		БАЙТ_1
    <font CLASS=comment>15:</font> 		БАЙТ_0
    <font CLASS=comment>16:</font> 		Адрес_на_подпрограмата_H
    <font CLASS=comment>17:</font> 		Адрес_на_подпрограмата_L
    <font CLASS=comment>18:</font> 
    <font CLASS=comment>19:</font> 	   Към БАЙТ_0 са "прикачени" най-младшите прекъсвания на процесора а към БАЙТ_3
    <font CLASS=comment>20:</font> 	най-старшите. Битове 6 и 7 битове са за индификация, започват от 00 и стигат до 11
    <font CLASS=comment>21:</font> 	(от 0 до 4, точно колкото да се "адресират" и 4-те байата).
    <font CLASS=comment>22:</font> 
    <font CLASS=comment>23:</font> 	   До днешна дата (16.06.2006) са включени прекъсвания INT0, INT1 и INT2 поради
    <font CLASS=comment>24:</font> 	факта, че все още не е определено кой прекъсвания ще бъдат изцяло предоставени на
    <font CLASS=comment>25:</font> 	ядрото и кой ще могат да се дават директно на процесите.
    <font CLASS=comment>26:</font> */</font>
    <font CLASS=comment>27:</font> 
    <font CLASS=comment>28:</font> <font CLASS=comment>//------------------------------------------------------------------------------------</font>
    <font CLASS=comment>29:</font> <font CLASS=comment>/*
    <font CLASS=comment>30:</font> 	R16 - Номера на процеса
    <font CLASS=comment>31:</font> 	R17 - Номера на прекъсването
    <font CLASS=comment>32:</font> */</font>
    <font CLASS=comment>33:</font> OSRemoveIRQFromTaskF:
    <font CLASS=comment>34:</font> 	push r18
    <font CLASS=comment>35:</font> 	push r19
    <font CLASS=comment>36:</font> 	push r20
    <font CLASS=comment>37:</font> 	push r21
    <font CLASS=comment>38:</font> 	push XL
    <font CLASS=comment>39:</font> 	push XH
    <font CLASS=comment>40:</font> 
    <font CLASS=comment>41:</font> 	call OSLoadTaskIRQTableF
    <font CLASS=comment>42:</font> 
    <font CLASS=comment>43:</font> 	cpi r17, OSINT0
    <font CLASS=comment>44:</font> 	breq OS_REMOVE_INT0
    <font CLASS=comment>45:</font> 	cpi r17, OSINT1
    <font CLASS=comment>46:</font> 	breq OS_REMOVE_INT1
    <font CLASS=comment>47:</font> 	cpi r17, OSOC2
    <font CLASS=comment>48:</font> 	breq OS_REMOVE_OC2
    <font CLASS=comment>49:</font> 	cpi r17, OSOVF2
    <font CLASS=comment>50:</font> 	breq OS_REMOVE_OVF2
    <font CLASS=comment>51:</font> 	cpi r17, OSICP1
    <font CLASS=comment>52:</font> 	breq OS_REMOVE_ICP1
    <font CLASS=comment>53:</font> 	cpi r17, OSOC1A
    <font CLASS=comment>54:</font> 	breq OS_REMOVE_OC1A
    <font CLASS=comment>55:</font> 
    <font CLASS=comment>56:</font> 	cpi r17, OSOC1B
    <font CLASS=comment>57:</font> 	breq OS_REMOVE_OC1B
    <font CLASS=comment>58:</font> 	cpi r17, OSOVF1
    <font CLASS=comment>59:</font> 	breq OS_REMOVE_OVF1
    <font CLASS=comment>60:</font> 	cpi r17, OSOVF0
    <font CLASS=comment>61:</font> 	breq OS_REMOVE_OVF0
    <font CLASS=comment>62:</font> 	cpi r17, OSSPI
    <font CLASS=comment>63:</font> 	breq OS_REMOVE_SPI
    <font CLASS=comment>64:</font> 	cpi r17, OSURXC
    <font CLASS=comment>65:</font> 	breq OS_REMOVE_URXC
    <font CLASS=comment>66:</font> 	cpi r17, OSUDRE
    <font CLASS=comment>67:</font> 	breq OS_REMOVE_UDRE
    <font CLASS=comment>68:</font> 
    <font CLASS=comment>69:</font> 	cpi r17, OSUTXC
    <font CLASS=comment>70:</font> 	breq OS_REMOVE_UTXC
    <font CLASS=comment>71:</font> 	cpi r17, OSADCC
    <font CLASS=comment>72:</font> 	breq OS_REMOVE_ADCC
    <font CLASS=comment>73:</font> 	cpi r17, OSERDY
    <font CLASS=comment>74:</font> 	breq OS_REMOVE_ERDY
    <font CLASS=comment>75:</font> 	cpi r17, OSACI
    <font CLASS=comment>76:</font> 	breq OS_REMOVE_ACI
    <font CLASS=comment>77:</font> 	cpi r17, OSTWI
    <font CLASS=comment>78:</font> 	breq OS_REMOVE_TWI
    <font CLASS=comment>79:</font> 	cpi r17, OSINT2
    <font CLASS=comment>80:</font> 	breq OS_REMOVE_INT2
    <font CLASS=comment>81:</font> 
    <font CLASS=comment>82:</font> 	cpi r17, OSOC0
    <font CLASS=comment>83:</font> 	breq OS_REMOVE_OC0
    <font CLASS=comment>84:</font> 	cpi r17, OSSPMR
    <font CLASS=comment>85:</font> 	breq OS_REMOVE_SPMR
    <font CLASS=comment>86:</font> 	
    <font CLASS=comment>87:</font> 	jmp OSRemoveIRQFromTaskRet
    <font CLASS=comment>88:</font> <font CLASS=comment>//------------------------------</font>
    <font CLASS=comment>89:</font> <font CLASS=comment>// IRQ Byte 0</font>
    <font CLASS=comment>90:</font> OS_REMOVE_INT0: cbr r18, OSINT0
    <font CLASS=comment>91:</font> jmp OSRemoveIRQFromTaskRet
    <font CLASS=comment>92:</font> 
    <font CLASS=comment>93:</font> OS_REMOVE_INT1: cbr r18, OSINT1
    <font CLASS=comment>94:</font> jmp OSRemoveIRQFromTaskRet
    <font CLASS=comment>95:</font> 
    <font CLASS=comment>96:</font> OS_REMOVE_OC2: cbr r18, <font CLASS=integer>4</font>
    <font CLASS=comment>97:</font> jmp OSRemoveIRQFromTaskRet
    <font CLASS=comment>98:</font> 
    <font CLASS=comment>99:</font> OS_REMOVE_OVF2: cbr r18, <font CLASS=integer>8</font>
   <font CLASS=comment>100:</font> jmp OSRemoveIRQFromTaskRet
   <font CLASS=comment>101:</font> 
   <font CLASS=comment>102:</font> OS_REMOVE_ICP1: cbr r18, <font CLASS=integer>16</font>
   <font CLASS=comment>103:</font> jmp OSRemoveIRQFromTaskRet
   <font CLASS=comment>104:</font> 
   <font CLASS=comment>105:</font> OS_REMOVE_OC1A: cbr r18, <font CLASS=integer>32</font>
   <font CLASS=comment>106:</font> jmp OSRemoveIRQFromTaskRet
   <font CLASS=comment>107:</font> <font CLASS=comment>//------------------------------</font>
   <font CLASS=comment>108:</font> <font CLASS=comment>// IRQ Byte 1</font>
   <font CLASS=comment>109:</font> OS_REMOVE_OC1B: cbr r19, <font CLASS=integer>1</font>
   <font CLASS=comment>110:</font> jmp OSRemoveIRQFromTaskRet
   <font CLASS=comment>111:</font> 
   <font CLASS=comment>112:</font> OS_REMOVE_OVF1: cbr r19, <font CLASS=integer>2</font>
   <font CLASS=comment>113:</font> jmp OSRemoveIRQFromTaskRet
   <font CLASS=comment>114:</font> 
   <font CLASS=comment>115:</font> OS_REMOVE_OVF0: cbr r19, <font CLASS=integer>4</font>
   <font CLASS=comment>116:</font> jmp OSRemoveIRQFromTaskRet
   <font CLASS=comment>117:</font> 
   <font CLASS=comment>118:</font> OS_REMOVE_SPI: cbr r19, <font CLASS=integer>8</font>
   <font CLASS=comment>119:</font> jmp OSRemoveIRQFromTaskRet
   <font CLASS=comment>120:</font> 
   <font CLASS=comment>121:</font> OS_REMOVE_URXC: cbr r19, <font CLASS=integer>16</font>
   <font CLASS=comment>122:</font> jmp OSRemoveIRQFromTaskRet
   <font CLASS=comment>123:</font> 
   <font CLASS=comment>124:</font> OS_REMOVE_UDRE: cbr r19, <font CLASS=integer>32</font>
   <font CLASS=comment>125:</font> jmp OSRemoveIRQFromTaskRet
   <font CLASS=comment>126:</font> <font CLASS=comment>//------------------------------</font>
   <font CLASS=comment>127:</font> <font CLASS=comment>// IRQ Byte 2</font>
   <font CLASS=comment>128:</font> OS_REMOVE_UTXC: cbr r20, <font CLASS=integer>1</font>
   <font CLASS=comment>129:</font> jmp OSRemoveIRQFromTaskRet
   <font CLASS=comment>130:</font> 
   <font CLASS=comment>131:</font> OS_REMOVE_ADCC: cbr r20, <font CLASS=integer>2</font>
   <font CLASS=comment>132:</font> jmp OSRemoveIRQFromTaskRet
   <font CLASS=comment>133:</font> 
   <font CLASS=comment>134:</font> OS_REMOVE_ERDY: cbr r20, <font CLASS=integer>4</font>
   <font CLASS=comment>135:</font> jmp OSRemoveIRQFromTaskRet
   <font CLASS=comment>136:</font> 
   <font CLASS=comment>137:</font> OS_REMOVE_ACI: cbr r20, <font CLASS=integer>8</font>
   <font CLASS=comment>138:</font> jmp OSRemoveIRQFromTaskRet
   <font CLASS=comment>139:</font> 
   <font CLASS=comment>140:</font> OS_REMOVE_TWI: cbr r20, <font CLASS=integer>16</font>
   <font CLASS=comment>141:</font> jmp OSRemoveIRQFromTaskRet
   <font CLASS=comment>142:</font> 
   <font CLASS=comment>143:</font> OS_REMOVE_INT2: cbr r20, <font CLASS=integer>32</font>
   <font CLASS=comment>144:</font> jmp OSRemoveIRQFromTaskRet
   <font CLASS=comment>145:</font> <font CLASS=comment>//------------------------------</font>
   <font CLASS=comment>146:</font> <font CLASS=comment>// IRQ Byte 3</font>
   <font CLASS=comment>147:</font> OS_REMOVE_OC0:	cbr r21, <font CLASS=integer>1</font>
   <font CLASS=comment>148:</font> jmp OSRemoveIRQFromTaskRet
   <font CLASS=comment>149:</font> 
   <font CLASS=comment>150:</font> OS_REMOVE_SPMR: cbr r21, <font CLASS=integer>2</font>
   <font CLASS=comment>151:</font> <font CLASS=comment>//------------------------------</font>
   <font CLASS=comment>152:</font> OSRemoveIRQFromTaskRet:
   <font CLASS=comment>153:</font> 	call OSSaveTaskIRQTableF
   <font CLASS=comment>154:</font> 	pop XH
   <font CLASS=comment>155:</font> 	pop XL
   <font CLASS=comment>156:</font> 	pop r21
   <font CLASS=comment>157:</font> 	pop r20
   <font CLASS=comment>158:</font> 	pop r19
   <font CLASS=comment>159:</font> 	pop r18
   <font CLASS=comment>160:</font> ret
   <font CLASS=comment>161:</font> <font CLASS=comment>//------------------------------------------------------------------------------------</font>
   <font CLASS=comment>162:</font> <font CLASS=comment>/*
   <font CLASS=comment>163:</font> 	R16 - Номера на процеса
   <font CLASS=comment>164:</font> 	R17 - Номера на прекъсването
   <font CLASS=comment>165:</font> 	XH:XL - Адреса на процедурата обработваща прекъсването
   <font CLASS=comment>166:</font> */</font>
   <font CLASS=comment>167:</font> OSAddIRQToTaskF:
   <font CLASS=comment>168:</font> 	push r18
   <font CLASS=comment>169:</font> 	push r19
   <font CLASS=comment>170:</font> 	push r20
   <font CLASS=comment>171:</font> 	push r21
   <font CLASS=comment>172:</font> 
   <font CLASS=comment>173:</font> 	push XL
   <font CLASS=comment>174:</font> 	push XH
   <font CLASS=comment>175:</font> 	call OSLoadTaskIRQTableF
   <font CLASS=comment>176:</font> 	pop XH
   <font CLASS=comment>177:</font> 	pop XL
   <font CLASS=comment>178:</font> 
   <font CLASS=comment>179:</font> 	cpi r17, OSINT0
   <font CLASS=comment>180:</font> 	breq OS_ADD_INT0
   <font CLASS=comment>181:</font> 	cpi r17, OSINT1
   <font CLASS=comment>182:</font> 	breq OS_ADD_INT1
   <font CLASS=comment>183:</font> 	cpi r17, OSOC2
   <font CLASS=comment>184:</font> 	breq OS_ADD_OC2
   <font CLASS=comment>185:</font> 	cpi r17, OSOVF2
   <font CLASS=comment>186:</font> 	breq OS_ADD_OVF2
   <font CLASS=comment>187:</font> 	cpi r17, OSICP1
   <font CLASS=comment>188:</font> 	breq OS_ADD_ICP1
   <font CLASS=comment>189:</font> 	cpi r17, OSOC1A
   <font CLASS=comment>190:</font> 	breq OS_ADD_OC1A
   <font CLASS=comment>191:</font> 
   <font CLASS=comment>192:</font> 	cpi r17, OSOC1B
   <font CLASS=comment>193:</font> 	breq OS_ADD_OC1B
   <font CLASS=comment>194:</font> 	cpi r17, OSOVF1
   <font CLASS=comment>195:</font> 	breq OS_ADD_OVF1
   <font CLASS=comment>196:</font> 	cpi r17, OSOVF0
   <font CLASS=comment>197:</font> 	breq OS_ADD_OVF0
   <font CLASS=comment>198:</font> 	cpi r17, OSSPI
   <font CLASS=comment>199:</font> 	breq OS_ADD_SPI
   <font CLASS=comment>200:</font> 	cpi r17, OSURXC
   <font CLASS=comment>201:</font> 	breq OS_ADD_URXC
   <font CLASS=comment>202:</font> 	cpi r17, OSUDRE
   <font CLASS=comment>203:</font> 	breq OS_ADD_UDRE
   <font CLASS=comment>204:</font> 
   <font CLASS=comment>205:</font> 	cpi r17, OSUTXC
   <font CLASS=comment>206:</font> 	breq OS_ADD_UTXC
   <font CLASS=comment>207:</font> 	cpi r17, OSADCC
   <font CLASS=comment>208:</font> 	breq OS_ADD_ADCC
   <font CLASS=comment>209:</font> 	cpi r17, OSERDY
   <font CLASS=comment>210:</font> 	breq OS_ADD_ERDY
   <font CLASS=comment>211:</font> 	cpi r17, OSACI
   <font CLASS=comment>212:</font> 	breq OS_ADD_ACI
   <font CLASS=comment>213:</font> 	cpi r17, OSTWI
   <font CLASS=comment>214:</font> 	breq OS_ADD_TWI
   <font CLASS=comment>215:</font> 	cpi r17, OSINT2
   <font CLASS=comment>216:</font> 	breq OS_ADD_INT2
   <font CLASS=comment>217:</font> 
   <font CLASS=comment>218:</font> 	cpi r17, OSOC0
   <font CLASS=comment>219:</font> 	breq OS_ADD_OC0
   <font CLASS=comment>220:</font> 	cpi r17, OSSPMR
   <font CLASS=comment>221:</font> 	breq OS_ADD_SPMR
   <font CLASS=comment>222:</font> 	
   <font CLASS=comment>223:</font> 	jmp OSAddIRQToTaskRet
   <font CLASS=comment>224:</font> <font CLASS=comment>//------------------------------</font>
   <font CLASS=comment>225:</font> <font CLASS=comment>// IRQ Byte 0</font>
   <font CLASS=comment>226:</font> OS_ADD_INT0: or r18, r17
   <font CLASS=comment>227:</font> jmp OSAddIRQToTaskRet
   <font CLASS=comment>228:</font> 
   <font CLASS=comment>229:</font> OS_ADD_INT1: or r18, r17
   <font CLASS=comment>230:</font> jmp OSAddIRQToTaskRet
   <font CLASS=comment>231:</font> 
   <font CLASS=comment>232:</font> OS_ADD_OC2: or r18, r17
   <font CLASS=comment>233:</font> jmp OSAddIRQToTaskRet
   <font CLASS=comment>234:</font> 
   <font CLASS=comment>235:</font> OS_ADD_OVF2: or r18, r17
   <font CLASS=comment>236:</font> jmp OSAddIRQToTaskRet
   <font CLASS=comment>237:</font> 
   <font CLASS=comment>238:</font> OS_ADD_ICP1: or r18, r17
   <font CLASS=comment>239:</font> jmp OSAddIRQToTaskRet
   <font CLASS=comment>240:</font> 
   <font CLASS=comment>241:</font> OS_ADD_OC1A: or r18, r17
   <font CLASS=comment>242:</font> jmp OSAddIRQToTaskRet
   <font CLASS=comment>243:</font> <font CLASS=comment>//------------------------------</font>
   <font CLASS=comment>244:</font> <font CLASS=comment>// IRQ Byte 1</font>
   <font CLASS=comment>245:</font> OS_ADD_OC1B: or r19, r17
   <font CLASS=comment>246:</font> jmp OSAddIRQToTaskRet
   <font CLASS=comment>247:</font> 
   <font CLASS=comment>248:</font> OS_ADD_OVF1: or r19, r17
   <font CLASS=comment>249:</font> jmp OSAddIRQToTaskRet
   <font CLASS=comment>250:</font> 
   <font CLASS=comment>251:</font> OS_ADD_OVF0: or r19, r17
   <font CLASS=comment>252:</font> jmp OSAddIRQToTaskRet
   <font CLASS=comment>253:</font> 
   <font CLASS=comment>254:</font> OS_ADD_SPI: or r19, r17
   <font CLASS=comment>255:</font> jmp OSAddIRQToTaskRet
   <font CLASS=comment>256:</font> 
   <font CLASS=comment>257:</font> OS_ADD_URXC: or r19, r17
   <font CLASS=comment>258:</font> jmp OSAddIRQToTaskRet
   <font CLASS=comment>259:</font> 
   <font CLASS=comment>260:</font> OS_ADD_UDRE: or r19, r17
   <font CLASS=comment>261:</font> jmp OSAddIRQToTaskRet
   <font CLASS=comment>262:</font> <font CLASS=comment>//------------------------------</font>
   <font CLASS=comment>263:</font> <font CLASS=comment>// IRQ Byte 2</font>
   <font CLASS=comment>264:</font> OS_ADD_UTXC: or r20, r17
   <font CLASS=comment>265:</font> jmp OSAddIRQToTaskRet
   <font CLASS=comment>266:</font> 
   <font CLASS=comment>267:</font> OS_ADD_ADCC: or r20, r17
   <font CLASS=comment>268:</font> jmp OSAddIRQToTaskRet
   <font CLASS=comment>269:</font> 
   <font CLASS=comment>270:</font> OS_ADD_ERDY: or r20, r17
   <font CLASS=comment>271:</font> jmp OSAddIRQToTaskRet
   <font CLASS=comment>272:</font> 
   <font CLASS=comment>273:</font> OS_ADD_ACI: or r20, r17
   <font CLASS=comment>274:</font> jmp OSAddIRQToTaskRet
   <font CLASS=comment>275:</font> 
   <font CLASS=comment>276:</font> OS_ADD_TWI: or r20, r17
   <font CLASS=comment>277:</font> jmp OSAddIRQToTaskRet
   <font CLASS=comment>278:</font> 
   <font CLASS=comment>279:</font> OS_ADD_INT2: or r20, r17
   <font CLASS=comment>280:</font> jmp OSAddIRQToTaskRet
   <font CLASS=comment>281:</font> <font CLASS=comment>//------------------------------</font>
   <font CLASS=comment>282:</font> <font CLASS=comment>// IRQ Byte 3</font>
   <font CLASS=comment>283:</font> OS_ADD_OC0:	or r21, r17
   <font CLASS=comment>284:</font> jmp OSAddIRQToTaskRet
   <font CLASS=comment>285:</font> 
   <font CLASS=comment>286:</font> OS_ADD_SPMR: or r21, r17
   <font CLASS=comment>287:</font> <font CLASS=comment>//------------------------------</font>
   <font CLASS=comment>288:</font> OSAddIRQToTaskRet:
   <font CLASS=comment>289:</font> 	call OSSaveTaskIRQTableF
   <font CLASS=comment>290:</font> 	pop r21
   <font CLASS=comment>291:</font> 	pop r20
   <font CLASS=comment>292:</font> 	pop r19
   <font CLASS=comment>293:</font> 	pop r18
   <font CLASS=comment>294:</font> ret
   <font CLASS=comment>295:</font> <font CLASS=comment>//------------------------------------------------------------------------------------</font>
   <font CLASS=comment>296:</font> <font CLASS=comment>/*
   <font CLASS=comment>297:</font> 	R16 - Номера на процеса
   <font CLASS=comment>298:</font> */</font>
   <font CLASS=comment>299:</font> OSInitTaskIRQF:
   <font CLASS=comment>300:</font> 	push r16
   <font CLASS=comment>301:</font> 	call OSLoadTaskIRQTableF
   <font CLASS=comment>302:</font> <font CLASS=comment>//------------------------------</font>
   <font CLASS=comment>303:</font> <font CLASS=comment>// Тука се нулират всички прекъсвания</font>
   <font CLASS=comment>304:</font> <font CLASS=comment>// на процесора </font>
   <font CLASS=comment>305:</font> <font CLASS=comment>// (без прекъсването на системния таймер де ;))</font>
   <font CLASS=comment>306:</font> <font CLASS=comment>// (недовършена част)</font>
   <font CLASS=comment>307:</font> 	clr r16
   <font CLASS=comment>308:</font> 	out GICR, r16
   <font CLASS=comment>309:</font> <font CLASS=comment>//------------------------------</font>
   <font CLASS=comment>310:</font> 	tst r18
   <font CLASS=comment>311:</font> 	breq OS_INIT_BYTE_1
   <font CLASS=comment>312:</font> 	
   <font CLASS=comment>313:</font> 	sbrs r18, <font CLASS=integer>0</font>
   <font CLASS=comment>314:</font> 	jmp OS_INIT_INT1
   <font CLASS=comment>315:</font> OS_INIT_INT0:
   <font CLASS=comment>316:</font> 	in r16, GICR
   <font CLASS=comment>317:</font> 	sbr r16, (<font CLASS=integer>1</font>&lt;&lt;INT0)
   <font CLASS=comment>318:</font> 	out GICR, r16
   <font CLASS=comment>319:</font> 	
   <font CLASS=comment>320:</font> 	sbrs r18, <font CLASS=integer>1</font>
   <font CLASS=comment>321:</font> 	jmp OS_INIT_OC2
   <font CLASS=comment>322:</font> OS_INIT_INT1:
   <font CLASS=comment>323:</font> 	in r16, GICR
   <font CLASS=comment>324:</font> 	sbr r16, (<font CLASS=integer>1</font>&lt;&lt;INT1)
   <font CLASS=comment>325:</font> 	out GICR, r16
   <font CLASS=comment>326:</font> 
   <font CLASS=comment>327:</font> 	sbrs r18, <font CLASS=integer>2</font>
   <font CLASS=comment>328:</font> 	jmp OS_INIT_OVF2
   <font CLASS=comment>329:</font> OS_INIT_OC2:
   <font CLASS=comment>330:</font> 
   <font CLASS=comment>331:</font> 	sbrs r18, <font CLASS=integer>3</font>
   <font CLASS=comment>332:</font> 	jmp OS_INIT_OVF2
   <font CLASS=comment>333:</font> OS_INIT_OVF2:
   <font CLASS=comment>334:</font> 
   <font CLASS=comment>335:</font> 	sbrs r18, <font CLASS=integer>4</font>
   <font CLASS=comment>336:</font> 	jmp OS_INIT_OC1A
   <font CLASS=comment>337:</font> OS_INIT_ICP1:
   <font CLASS=comment>338:</font> 
   <font CLASS=comment>339:</font> 	sbrs r18, <font CLASS=integer>5</font>
   <font CLASS=comment>340:</font> 	jmp OS_INIT_BYTE_1
   <font CLASS=comment>341:</font> OS_INIT_OC1A:
   <font CLASS=comment>342:</font> <font CLASS=comment>//------------------------------</font>
   <font CLASS=comment>343:</font> OS_INIT_BYTE_1:
   <font CLASS=comment>344:</font> 	tst r19
   <font CLASS=comment>345:</font> 	breq OS_INIT_BYTE_2
   <font CLASS=comment>346:</font> 
   <font CLASS=comment>347:</font> 	sbrs r19, <font CLASS=integer>0</font>
   <font CLASS=comment>348:</font> 	jmp OS_INIT_OVF1
   <font CLASS=comment>349:</font> OS_INIT_OC1B:
   <font CLASS=comment>350:</font> 
   <font CLASS=comment>351:</font> 	sbrs r19, <font CLASS=integer>1</font>
   <font CLASS=comment>352:</font> 	jmp OS_INIT_OVF0
   <font CLASS=comment>353:</font> OS_INIT_OVF1:
   <font CLASS=comment>354:</font> 
   <font CLASS=comment>355:</font> 	sbrs r19, <font CLASS=integer>2</font>
   <font CLASS=comment>356:</font> 	jmp OS_INIT_SPI
   <font CLASS=comment>357:</font> OS_INIT_OVF0:
   <font CLASS=comment>358:</font> 
   <font CLASS=comment>359:</font> 	sbrs r19, <font CLASS=integer>3</font>
   <font CLASS=comment>360:</font> 	jmp OS_INIT_URXC
   <font CLASS=comment>361:</font> OS_INIT_SPI:
   <font CLASS=comment>362:</font> 
   <font CLASS=comment>363:</font> 	sbrs r19, <font CLASS=integer>4</font>
   <font CLASS=comment>364:</font> 	jmp OS_INIT_UDRE
   <font CLASS=comment>365:</font> OS_INIT_URXC:
   <font CLASS=comment>366:</font> 
   <font CLASS=comment>367:</font> 	sbrs r20, <font CLASS=integer>5</font>
   <font CLASS=comment>368:</font> 	jmp OS_INIT_BYTE_2
   <font CLASS=comment>369:</font> OS_INIT_UDRE:
   <font CLASS=comment>370:</font> 
   <font CLASS=comment>371:</font> <font CLASS=comment>//------------------------------</font>
   <font CLASS=comment>372:</font> OS_INIT_BYTE_2:
   <font CLASS=comment>373:</font> 	tst r20
   <font CLASS=comment>374:</font> 	breq OS_INIT_BYTE_3
   <font CLASS=comment>375:</font> 
   <font CLASS=comment>376:</font> 	sbrs r20, <font CLASS=integer>0</font>
   <font CLASS=comment>377:</font> 	jmp OS_INIT_ADCC
   <font CLASS=comment>378:</font> OS_INIT_UTXC:
   <font CLASS=comment>379:</font> 
   <font CLASS=comment>380:</font> 	sbrs r20, <font CLASS=integer>1</font>
   <font CLASS=comment>381:</font> 	jmp OS_INIT_ERDY
   <font CLASS=comment>382:</font> OS_INIT_ADCC:
   <font CLASS=comment>383:</font> 
   <font CLASS=comment>384:</font> 	sbrs r20, <font CLASS=integer>2</font>
   <font CLASS=comment>385:</font> 	jmp OS_INIT_ACI
   <font CLASS=comment>386:</font> OS_INIT_ERDY:
   <font CLASS=comment>387:</font> 
   <font CLASS=comment>388:</font> 	sbrs r20, <font CLASS=integer>3</font>
   <font CLASS=comment>389:</font> 	jmp OS_INIT_TWI
   <font CLASS=comment>390:</font> OS_INIT_ACI:
   <font CLASS=comment>391:</font> 
   <font CLASS=comment>392:</font> 	sbrs r20, <font CLASS=integer>4</font>
   <font CLASS=comment>393:</font> 	jmp OS_INIT_INT2
   <font CLASS=comment>394:</font> OS_INIT_TWI:
   <font CLASS=comment>395:</font> 
   <font CLASS=comment>396:</font> 	sbrs r20, <font CLASS=integer>5</font>
   <font CLASS=comment>397:</font> 	jmp OS_INIT_BYTE_3
   <font CLASS=comment>398:</font> OS_INIT_INT2:
   <font CLASS=comment>399:</font> 	in r16, GICR
   <font CLASS=comment>400:</font> 	sbr r16, (<font CLASS=integer>1</font>&lt;&lt;INT2)
   <font CLASS=comment>401:</font> 	out GICR, r16
   <font CLASS=comment>402:</font> <font CLASS=comment>//------------------------------</font>
   <font CLASS=comment>403:</font> OS_INIT_BYTE_3:
   <font CLASS=comment>404:</font> 	tst r21
   <font CLASS=comment>405:</font> 	breq OSInitTaskIRQFRet
   <font CLASS=comment>406:</font> 
   <font CLASS=comment>407:</font> 	sbrs r21, <font CLASS=integer>0</font>
   <font CLASS=comment>408:</font> 	jmp OS_INIT_SPMR
   <font CLASS=comment>409:</font> OS_INIT_OC0:
   <font CLASS=comment>410:</font> 
   <font CLASS=comment>411:</font> 	sbrs r21, <font CLASS=integer>1</font>
   <font CLASS=comment>412:</font> 	jmp OSInitTaskIRQFRet
   <font CLASS=comment>413:</font> OS_INIT_SPMR:
   <font CLASS=comment>414:</font> 
   <font CLASS=comment>415:</font> OSInitTaskIRQFRet:
   <font CLASS=comment>416:</font> 	pop r16
   <font CLASS=comment>417:</font> ret
   <font CLASS=comment>418:</font> <font CLASS=comment>//------------------------------------------------------------------------------------</font>
   <font CLASS=comment>419:</font> <font CLASS=comment>/*
   <font CLASS=comment>420:</font> 	R16 - Номер на процеса
   <font CLASS=comment>421:</font> 	R21:R20:R19:R18 - Таблицата на прекъсванията
   <font CLASS=comment>422:</font> 	XH:XL - Адреса на процедурата обработваща прекъсването
   <font CLASS=comment>423:</font> */</font>
   <font CLASS=comment>424:</font> OSSaveTaskIRQTableF:
   <font CLASS=comment>425:</font> 	push ZL
   <font CLASS=comment>426:</font> 	push ZH
   <font CLASS=comment>427:</font> 
   <font CLASS=comment>428:</font> 	OSGetDisplacementOfTask r16
   <font CLASS=comment>429:</font> 	adiw ZH:ZL, DISPLACEMENT_OF_TASK_IRQ
   <font CLASS=comment>430:</font> 	
   <font CLASS=comment>431:</font> 	st Z<font CLASS=symbols>+</font>, r21
   <font CLASS=comment>432:</font> 	st Z<font CLASS=symbols>+</font>, r20
   <font CLASS=comment>433:</font> 	st Z<font CLASS=symbols>+</font>, r19
   <font CLASS=comment>434:</font> 	st Z<font CLASS=symbols>+</font>, r18
   <font CLASS=comment>435:</font> 	st Z<font CLASS=symbols>+</font>, XH
   <font CLASS=comment>436:</font> 	st Z<font CLASS=symbols>+</font>, XL
   <font CLASS=comment>437:</font> 	
   <font CLASS=comment>438:</font> 	pop ZH
   <font CLASS=comment>439:</font> 	pop ZL
   <font CLASS=comment>440:</font> ret
   <font CLASS=comment>441:</font> <font CLASS=comment>//------------------------------------------------------------------------------------</font>
   <font CLASS=comment>442:</font> OSINT0F: cli
   <font CLASS=comment>443:</font> 	OSRunTaskIRQC OSINT0
   <font CLASS=comment>444:</font> reti
   <font CLASS=comment>445:</font> 
   <font CLASS=comment>446:</font> OSINT1F: cli
   <font CLASS=comment>447:</font> 	OSRunTaskIRQC OSINT1
   <font CLASS=comment>448:</font> reti
   <font CLASS=comment>449:</font> 
   <font CLASS=comment>450:</font> OSOC2F: cli
   <font CLASS=comment>451:</font> 	OSRunTaskIRQC OSOC2
   <font CLASS=comment>452:</font> reti
   <font CLASS=comment>453:</font> 
   <font CLASS=comment>454:</font> OSOVF2F: cli
   <font CLASS=comment>455:</font> 	OSRunTaskIRQC OSOVF2
   <font CLASS=comment>456:</font> reti
   <font CLASS=comment>457:</font> 
   <font CLASS=comment>458:</font> OSICP1F: cli
   <font CLASS=comment>459:</font> 	OSRunTaskIRQC OSICP1
   <font CLASS=comment>460:</font> reti
   <font CLASS=comment>461:</font> 
   <font CLASS=comment>462:</font> OSOC1AF: cli
   <font CLASS=comment>463:</font> 	OSRunTaskIRQC OSOC1A
   <font CLASS=comment>464:</font> reti
   <font CLASS=comment>465:</font> 
   <font CLASS=comment>466:</font> OSOC1BF: cli
   <font CLASS=comment>467:</font> 	OSRunTaskIRQC OSOC1B
   <font CLASS=comment>468:</font> reti
   <font CLASS=comment>469:</font> 
   <font CLASS=comment>470:</font> OSOVF1F: cli
   <font CLASS=comment>471:</font> 	OSRunTaskIRQC OSOVF1
   <font CLASS=comment>472:</font> reti
   <font CLASS=comment>473:</font> 
   <font CLASS=comment>474:</font> OSOVF0F: cli
   <font CLASS=comment>475:</font> 	OSRunTaskIRQC OSOVF0
   <font CLASS=comment>476:</font> reti
   <font CLASS=comment>477:</font> 
   <font CLASS=comment>478:</font> OSSPIF: cli
   <font CLASS=comment>479:</font> 	OSRunTaskIRQC OSSPI 
   <font CLASS=comment>480:</font> reti
   <font CLASS=comment>481:</font> 
   <font CLASS=comment>482:</font> OSADCCF: cli
   <font CLASS=comment>483:</font> 	OSRunTaskIRQC OSADCC
   <font CLASS=comment>484:</font> reti
   <font CLASS=comment>485:</font> 
   <font CLASS=comment>486:</font> OSERDYF: cli
   <font CLASS=comment>487:</font> 	OSRunTaskIRQC OSERDY
   <font CLASS=comment>488:</font> reti
   <font CLASS=comment>489:</font> 
   <font CLASS=comment>490:</font> OSACIF: cli
   <font CLASS=comment>491:</font> 	OSRunTaskIRQC OSACI
   <font CLASS=comment>492:</font> reti
   <font CLASS=comment>493:</font> 
   <font CLASS=comment>494:</font> OSTWIF: cli
   <font CLASS=comment>495:</font> 	OSRunTaskIRQC OSTWI
   <font CLASS=comment>496:</font> reti
   <font CLASS=comment>497:</font> 
   <font CLASS=comment>498:</font> OSINT2F: cli
   <font CLASS=comment>499:</font> 	OSRunTaskIRQC OSINT2
   <font CLASS=comment>500:</font> reti
   <font CLASS=comment>501:</font> 
   <font CLASS=comment>502:</font> OSSPMRF: cli
   <font CLASS=comment>503:</font> 	OSRunTaskIRQC OSSPMR
   <font CLASS=comment>504:</font> reti
   <font CLASS=comment>505:</font> <font CLASS=comment>//------------------------------------------------------------------------------------</font>
   <font CLASS=comment>506:</font> <font CLASS=comment>/*
   <font CLASS=comment>507:</font> 	R16 - Номера на прекъсването
   <font CLASS=comment>508:</font> */</font>
   <font CLASS=comment>509:</font> OSRunTaskIRQF:
   <font CLASS=comment>510:</font> 	OSSaveH r17
   <font CLASS=comment>511:</font> 	mov r17, r16
   <font CLASS=comment>512:</font> 	OSLoadL r16
   <font CLASS=comment>513:</font> 	push r16
   <font CLASS=comment>514:</font> 	OSGetNumberOfCurrentTask r16
   <font CLASS=comment>515:</font> 	OSSendMessage r16, r17
   <font CLASS=comment>516:</font> 	OSLoadH r17
   <font CLASS=comment>517:</font> 
   <font CLASS=comment>518:</font> 	OSSaveL XL
   <font CLASS=comment>519:</font> 	OSSaveH XH
   <font CLASS=comment>520:</font> 	push r18
   <font CLASS=comment>521:</font> 	push r19
   <font CLASS=comment>522:</font> 	push r20
   <font CLASS=comment>523:</font> 	push r21
   <font CLASS=comment>524:</font> 	call OSLoadTaskIRQTableF
   <font CLASS=comment>525:</font> 	pop r21
   <font CLASS=comment>526:</font> 	pop r20
   <font CLASS=comment>527:</font> 	pop r19
   <font CLASS=comment>528:</font> 	pop r18
   <font CLASS=comment>529:</font> 	pop r16
   <font CLASS=comment>530:</font> 
   <font CLASS=comment>531:</font> 	tst XH
   <font CLASS=comment>532:</font> 	brne OSICallTaskIRQ
   <font CLASS=comment>533:</font> 	tst XL
   <font CLASS=comment>534:</font> 	brne OSICallTaskIRQ
   <font CLASS=comment>535:</font> 
   <font CLASS=comment>536:</font> 	OSLoadL XL
   <font CLASS=comment>537:</font> 	OSLoadH XH
   <font CLASS=comment>538:</font> 	jmp OSRunTaskIRQFRet
   <font CLASS=comment>539:</font> 
   <font CLASS=comment>540:</font> OSICallTaskIRQ:
   <font CLASS=comment>541:</font> 	push XL
   <font CLASS=comment>542:</font> 	push XH
   <font CLASS=comment>543:</font> 	OSLoadL XL
   <font CLASS=comment>544:</font> 	OSLoadH XH
   <font CLASS=comment>545:</font> 	reti
   <font CLASS=comment>546:</font> OSRunTaskIRQFRet:
   <font CLASS=comment>547:</font> reti
   <font CLASS=comment>548:</font> <font CLASS=comment>//------------------------------------------------------------------------------------</font>
   <font CLASS=comment>549:</font> <font CLASS=comment>/*
   <font CLASS=comment>550:</font> 	R16 - Номера на процеса
   <font CLASS=comment>551:</font> 	return:
   <font CLASS=comment>552:</font> 		XH:XL - Адреса на процедурата обработваща прекъсването
   <font CLASS=comment>553:</font> 		R21:R20:R19:R18 - Таблицата на прекъсванията
   <font CLASS=comment>554:</font> */</font>
   <font CLASS=comment>555:</font> OSLoadTaskIRQTableF:
   <font CLASS=comment>556:</font> 	push ZL
   <font CLASS=comment>557:</font> 	push ZH
   <font CLASS=comment>558:</font> 
   <font CLASS=comment>559:</font> 	OSGetDisplacementOfTask r16
   <font CLASS=comment>560:</font> 	adiw ZH:ZL, DISPLACEMENT_OF_TASK_IRQ
   <font CLASS=comment>561:</font> 	
   <font CLASS=comment>562:</font> 	ld r21, Z<font CLASS=symbols>+</font>
   <font CLASS=comment>563:</font> 	ld r20, Z<font CLASS=symbols>+</font>
   <font CLASS=comment>564:</font> 	ld r19, Z<font CLASS=symbols>+</font>
   <font CLASS=comment>565:</font> 	ld r18, Z<font CLASS=symbols>+</font>
   <font CLASS=comment>566:</font> 	ld XH, Z<font CLASS=symbols>+</font>
   <font CLASS=comment>567:</font> 	ld XL, Z<font CLASS=symbols>+</font>
   <font CLASS=comment>568:</font> 	
   <font CLASS=comment>569:</font> 	pop ZH
   <font CLASS=comment>570:</font> 	pop ZL
   <font CLASS=comment>571:</font> ret
   <font CLASS=comment>572:</font> <font CLASS=comment>//------------------------------------------------------------------------------------</font>
   <font CLASS=comment>573:</font> 


</pre>

</div>


</body>
</html>
