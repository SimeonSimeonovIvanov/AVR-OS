<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<!--
Syntax highlighting generated by Web C Plus Plus software v0.8.4
Webcpp Copyright (C)2001-2004 Jeffrey Bakker under the GNU GPL
Get webcpp at http://webcpp.sf.net
-->

<html>
<head>
<title>AVR-OS-API.inc</title>
<style type="text/css">

/*
Webcpp v0.8.1 compatible StyleSheet
http://webcpp.sf.net
Theme: typical
*/

body
{
background-color: #f9f9f9
}

.webcpp a:link    {color:#00b800}
.webcpp a:visited {color:#666666}
.webcpp a:active  {color:#224fff}
.webcpp a:hover   {color:#a900a9}

.webcpp pre
{
color: #000000
}

.webcpp font
{
font-size:100%
}

.webcpp .symbols
{
color: #0077dd
}

.webcpp .preproc
{
color: #a900a9
}

.webcpp .integer
{
color: #ff0032
}

.webcpp .floatpt
{
color: #ff23a6
}

.webcpp .dblquot
{
color: #00b800
}

.webcpp .sinquot
{
color: #00b86b
}

.webcpp .keyword
{
color: #224fff;
font-weight: bold
}

.webcpp .keytype
{
color: #ff9933;
font-weight: bold
}

.webcpp .comment
{
color: #666666;
font-style: italic
}

</style>
</head>
<body>

<div class="webcpp">
<pre>
     <font CLASS=comment>1:</font> <font CLASS=comment>/*
     <font CLASS=comment>2:</font> 			AVR-Os Version 0.71
     <font CLASS=comment>3:</font> 		
     <font CLASS=comment>4:</font> 		The^day^of^DooM
     <font CLASS=comment>5:</font> 
     <font CLASS=comment>6:</font> 	Create date:   03.04.2006
     <font CLASS=comment>7:</font> 	Last Update:   21.07.2006
     <font CLASS=comment>8:</font> 
     <font CLASS=comment>9:</font>    -------------------------------------------------------------------------------------
    <font CLASS=comment>10:</font>         Масив на процесите - съставен от структури с рамер SIZE_OF_TASK_STRUCTURE:
    <font CLASS=comment>11:</font> 
    <font CLASS=comment>12:</font>                 TASK_DISPLACEMENT+0  - STATUS
    <font CLASS=comment>13:</font> 
    <font CLASS=comment>14:</font> 				TASK_DISPLACEMENT+1  - SPH
    <font CLASS=comment>15:</font>                 TASK_DISPLACEMENT+2  - SPL
    <font CLASS=comment>16:</font> 
    <font CLASS=comment>17:</font>                 TASK_DISPLACEMENT+3  - TCNTxH
    <font CLASS=comment>18:</font>                 TASK_DISPLACEMENT+4  - TCNTxL
    <font CLASS=comment>19:</font> 
    <font CLASS=comment>20:</font>                 TASK_DISPLACEMENT+5  - IRQ_TABLE_BYTE_3
    <font CLASS=comment>21:</font>                 TASK_DISPLACEMENT+6  - IRQ_TABLE_BYTE_2
    <font CLASS=comment>22:</font>                 TASK_DISPLACEMENT+7  - IRQ_TABLE_BYTE_1
    <font CLASS=comment>23:</font>                 TASK_DISPLACEMENT+8  - IRQ_TABLE_BYTE_0
    <font CLASS=comment>24:</font>                 TASK_DISPLACEMENT+9  - IRQH
    <font CLASS=comment>25:</font>                 TASK_DISPLACEMENT+10  - IRQL
    <font CLASS=comment>26:</font> 
    <font CLASS=comment>27:</font>                 TASK_DISPLACEMENT+11  - Message
    <font CLASS=comment>28:</font>                 TASK_DISPLACEMENT+12  - From...
    <font CLASS=comment>29:</font> 
    <font CLASS=comment>30:</font>        !!! TASK_DISPLACEMENT=((NUMBER_OF_TASK * SIZE_OF_TASK_STRUCTURE) - <font CLASS=preproc>$3</font>) !!!
    <font CLASS=comment>31:</font>    -------------------------------------------------------------------------------------
    <font CLASS=comment>32:</font> 
    <font CLASS=comment>33:</font>                                      *ВАЖНО*
    <font CLASS=comment>34:</font> 
    <font CLASS=comment>35:</font>       1)  При премахване на даден процес то слдващите след него (ако има)
    <font CLASS=comment>36:</font> 	 си смъкват номера с един надоло.
    <font CLASS=comment>37:</font> */</font>
    <font CLASS=comment>38:</font> 
    <font CLASS=comment>39:</font> <font CLASS=comment>#define USART</font>
    <font CLASS=comment>40:</font> <font CLASS=comment>#define DISPLAY</font>
    <font CLASS=comment>41:</font> <font CLASS=comment>#define DISPLAY_DEBUG</font>
    <font CLASS=comment>42:</font> 
    <font CLASS=comment>43:</font> .<font CLASS=keyword>include</font> <font CLASS=dblquot>"<a href="kernel/api/irq-api.inc.html">scr/kernel/api/irq-api.inc</a>"</font>
    <font CLASS=comment>44:</font> .<font CLASS=keyword>include</font> <font CLASS=dblquot>"<a href="kernel/api/task-api.inc.html">scr/kernel/api/task-api.inc</a>"</font>
    <font CLASS=comment>45:</font> .<font CLASS=keyword>include</font> <font CLASS=dblquot>"<a href="kernel/api/timer-api.inc.html">scr/kernel/api/timer-api.inc</a>"</font>
    <font CLASS=comment>46:</font> .<font CLASS=keyword>include</font> <font CLASS=dblquot>"<a href="kernel/api/message-api.inc.html">scr/kernel/api/message-api.inc</a>"</font>
    <font CLASS=comment>47:</font> 
    <font CLASS=comment>48:</font> <font CLASS=comment>#ifdef USART</font>
    <font CLASS=comment>49:</font> .<font CLASS=keyword>include</font> <font CLASS=dblquot>"<a href="drivers/usart/usart-api.inc.html">scr/drivers/usart/usart-api.inc</a>"</font>
    <font CLASS=comment>50:</font> <font CLASS=comment>#endif</font>
    <font CLASS=comment>51:</font> 
    <font CLASS=comment>52:</font> <font CLASS=comment>#ifdef DISPLAY</font>
    <font CLASS=comment>53:</font> .<font CLASS=keyword>include</font> <font CLASS=dblquot>"<a href="drivers/display/display-api.inc.html">scr/drivers/display/display-api.inc</a>"</font>
    <font CLASS=comment>54:</font> <font CLASS=comment>#endif</font>
    <font CLASS=comment>55:</font> 
    <font CLASS=comment>56:</font> <font CLASS=comment>// ----------------------------------------------------------------</font>
    <font CLASS=comment>57:</font> <font CLASS=comment>//	Глобални константи:</font>
    <font CLASS=comment>58:</font> .equ	<font CLASS=keyword>NULL</font><font CLASS=symbols>=</font><font CLASS=integer>0</font>
    <font CLASS=comment>59:</font> .equ	TASK_IS_RUN=<font CLASS=keyword>NULL</font>
    <font CLASS=comment>60:</font> .equ	TASK_IS_STOP=<font CLASS=keyword>NULL</font><font CLASS=symbols>+</font><font CLASS=integer>1</font>
    <font CLASS=comment>61:</font> <font CLASS=comment>// -------------------------------------------------------------</font>
    <font CLASS=comment>62:</font> <font CLASS=comment>//</font>
    <font CLASS=comment>63:</font> <font CLASS=comment>//					!!! НЕ ПРОМЕНЯЙ !!!</font>
    <font CLASS=comment>64:</font> <font CLASS=comment>//</font>
    <font CLASS=comment>65:</font> <font CLASS=comment>//		Тука са декларирани отместванията на различните</font>
    <font CLASS=comment>66:</font> <font CLASS=comment>//	елементи в структурата на процеса, крайната и големина и д.р</font>
    <font CLASS=comment>67:</font> 
    <font CLASS=comment>68:</font> .equ DISPLACEMENT_OF_TASK_IRQ<font CLASS=symbols>=</font><font CLASS=integer>5</font>
    <font CLASS=comment>69:</font> .equ DISPLACEMENT_OF_TASK_MESSAGE_BOX<font CLASS=symbols>=</font><font CLASS=integer>11</font>
    <font CLASS=comment>70:</font> .equ SIZE_OF_TASK_STRUCTURE	<font CLASS=symbols>=</font> <font CLASS=integer>100</font>
    <font CLASS=comment>71:</font> <font CLASS=comment>// ----------------------------------------------------------------</font>
    <font CLASS=comment>72:</font> <font CLASS=comment>//	Адреси на системните променливи:</font>
    <font CLASS=comment>73:</font> 
    <font CLASS=comment>74:</font> .equ	TASK_COUNTER=ramend
    <font CLASS=comment>75:</font> .equ	CURRENT_TASK=ramend<font CLASS=symbols>-</font><font CLASS=integer>1</font>
    <font CLASS=comment>76:</font> 
    <font CLASS=comment>77:</font> .equ	SYSTEM_MESSAGE=ramend<font CLASS=symbols>-</font><font CLASS=integer>2</font>
    <font CLASS=comment>78:</font> .equ	SYSTEM_MESSAGE_FROM=ramend<font CLASS=symbols>-</font><font CLASS=integer>3</font>
    <font CLASS=comment>79:</font> 
    <font CLASS=comment>80:</font> .equ	OS_TEMP_H=ramend<font CLASS=symbols>-</font><font CLASS=integer>4</font>
    <font CLASS=comment>81:</font> .equ	OS_TEMP_L=ramend<font CLASS=symbols>-</font><font CLASS=integer>5</font>
    <font CLASS=comment>82:</font> 
    <font CLASS=comment>83:</font> .equ 	USART_STATUS=ramend<font CLASS=symbols>-</font><font CLASS=integer>6</font>
    <font CLASS=comment>84:</font> 
    <font CLASS=comment>85:</font> .equ	OSDisplayStatus=ramend<font CLASS=symbols>-</font><font CLASS=integer>7</font>
    <font CLASS=comment>86:</font> .equ	OSDisplayX=ramend<font CLASS=symbols>-</font><font CLASS=integer>8</font>
    <font CLASS=comment>87:</font> .equ	OSDisplayY=ramend<font CLASS=symbols>-</font><font CLASS=integer>9</font>
    <font CLASS=comment>88:</font> 
    <font CLASS=comment>89:</font> .equ	OSSPH=ramend<font CLASS=symbols>-</font><font CLASS=integer>10</font>
    <font CLASS=comment>90:</font> .equ	OSSPL=ramend<font CLASS=symbols>-</font><font CLASS=integer>11</font>
    <font CLASS=comment>91:</font> <font CLASS=comment>// -----------------------------------------</font>
    <font CLASS=comment>92:</font> .macro OSInit
    <font CLASS=comment>93:</font> .cseg
    <font CLASS=comment>94:</font> .org <font CLASS=preproc>$<font CLASS=integer>000</font></font>
    <font CLASS=comment>95:</font> 	jmp OSReset
    <font CLASS=comment>96:</font> .org INT0addr
    <font CLASS=comment>97:</font> 	jmp OSINT0F
    <font CLASS=comment>98:</font> .org INT1addr
    <font CLASS=comment>99:</font> 	jmp OSINT1F
   <font CLASS=comment>100:</font> .org OC2addr
   <font CLASS=comment>101:</font> 	jmp OSOC2F
   <font CLASS=comment>102:</font> .org OVF2addr
   <font CLASS=comment>103:</font> 	jmp OSOVF2F
   <font CLASS=comment>104:</font> .org ICP1addr
   <font CLASS=comment>105:</font> 	jmp OSICP1F
   <font CLASS=comment>106:</font> .org OC1Aaddr
   <font CLASS=comment>107:</font> 	jmp OSOC1AF
   <font CLASS=comment>108:</font> .org OC1Baddr
   <font CLASS=comment>109:</font> 	jmp OSOC1BF
   <font CLASS=comment>110:</font> .org OVF1addr
   <font CLASS=comment>111:</font> 	jmp OSOVF1F
   <font CLASS=comment>112:</font> .org OVF0addr
   <font CLASS=comment>113:</font> 	jmp OSOVF0F
   <font CLASS=comment>114:</font> .org SPIaddr
   <font CLASS=comment>115:</font> 	jmp OSSPIF
   <font CLASS=comment>116:</font> <font CLASS=comment>#ifdef USART</font>
   <font CLASS=comment>117:</font> .org URXCaddr		; Rx Complete
   <font CLASS=comment>118:</font> 	rjmp RXdone
   <font CLASS=comment>119:</font> .org UDREaddr		; Data Register Empty
   <font CLASS=comment>120:</font> 	rjmp TXempty
   <font CLASS=comment>121:</font> .org UTXCaddr		; Tx Complete
   <font CLASS=comment>122:</font> 	rjmp TXdone
   <font CLASS=comment>123:</font> <font CLASS=comment>#endif</font>
   <font CLASS=comment>124:</font> .org ADCCaddr
   <font CLASS=comment>125:</font> 	jmp OSADCCF
   <font CLASS=comment>126:</font> .org ERDYaddr
   <font CLASS=comment>127:</font> 	jmp OSERDYF
   <font CLASS=comment>128:</font> .org ACIaddr
   <font CLASS=comment>129:</font> 	jmp OSACIF
   <font CLASS=comment>130:</font> .org TWIaddr
   <font CLASS=comment>131:</font> 	jmp OSTWI
   <font CLASS=comment>132:</font> .org INT2addr
   <font CLASS=comment>133:</font> 	jmp OSINT2F
   <font CLASS=comment>134:</font> .org OC0addr
   <font CLASS=comment>135:</font> 		jmp OSTaskManagerF
   <font CLASS=comment>136:</font> .org SPMRaddr
   <font CLASS=comment>137:</font> 	jmp OSSPMRF
   <font CLASS=comment>138:</font> OSReset:
   <font CLASS=comment>139:</font> 	ldi r16, high(OSSPH)
   <font CLASS=comment>140:</font> 	out sph, r16
   <font CLASS=comment>141:</font> 	ldi r16, low(OSSPL)
   <font CLASS=comment>142:</font> 	out spl, r16
   <font CLASS=comment>143:</font> 
   <font CLASS=comment>144:</font> 	clr r16
   <font CLASS=comment>145:</font> 	sts CURRENT_TASK, r16
   <font CLASS=comment>146:</font> 	sts TASK_COUNTER, r16
   <font CLASS=comment>147:</font> 
   <font CLASS=comment>148:</font> <font CLASS=comment>#ifdef USART</font>
   <font CLASS=comment>149:</font> 	USARTInit
   <font CLASS=comment>150:</font> <font CLASS=comment>#endif</font>
   <font CLASS=comment>151:</font> 
   <font CLASS=comment>152:</font> <font CLASS=comment>#ifdef DISPLAY</font>
   <font CLASS=comment>153:</font> 	OSDisplayInit
   <font CLASS=comment>154:</font> <font CLASS=comment>#endif</font>
   <font CLASS=comment>155:</font> .endmacro
   <font CLASS=comment>156:</font> <font CLASS=comment>// -------------------------</font>
   <font CLASS=comment>157:</font> .macro OSSaveH
   <font CLASS=comment>158:</font> 	sts OS_TEMP_H, @<font CLASS=integer>0</font>
   <font CLASS=comment>159:</font> .endmacro
   <font CLASS=comment>160:</font> 
   <font CLASS=comment>161:</font> .macro OSSaveToTempH
   <font CLASS=comment>162:</font> 	sts OS_TEMP_H, @<font CLASS=integer>0</font>
   <font CLASS=comment>163:</font> .endmacro
   <font CLASS=comment>164:</font> <font CLASS=comment>// -------------------------</font>
   <font CLASS=comment>165:</font> .macro OSSaveL
   <font CLASS=comment>166:</font> 	sts OS_TEMP_L, @<font CLASS=integer>0</font>
   <font CLASS=comment>167:</font> .endmacro
   <font CLASS=comment>168:</font> 
   <font CLASS=comment>169:</font> .macro OSSaveToTempL
   <font CLASS=comment>170:</font> 	sts OS_TEMP_L, @<font CLASS=integer>0</font>
   <font CLASS=comment>171:</font> .endmacro
   <font CLASS=comment>172:</font> <font CLASS=comment>// -------------------------</font>
   <font CLASS=comment>173:</font> .macro OSLoadH
   <font CLASS=comment>174:</font> 	lds @<font CLASS=integer>0</font>, OS_TEMP_H
   <font CLASS=comment>175:</font> .endmacro
   <font CLASS=comment>176:</font> 
   <font CLASS=comment>177:</font> .macro OSLoadFromTempH
   <font CLASS=comment>178:</font> 	lds @<font CLASS=integer>0</font>, OS_TEMP_H
   <font CLASS=comment>179:</font> .endmacro
   <font CLASS=comment>180:</font> <font CLASS=comment>// -------------------------</font>
   <font CLASS=comment>181:</font> .macro OSLoadL
   <font CLASS=comment>182:</font> 	lds @<font CLASS=integer>0</font>, OS_TEMP_L
   <font CLASS=comment>183:</font> .endmacro
   <font CLASS=comment>184:</font> 
   <font CLASS=comment>185:</font> .macro OSLoadFromTempL
   <font CLASS=comment>186:</font> 	lds @<font CLASS=integer>0</font>, OS_TEMP_L
   <font CLASS=comment>187:</font> .endmacro
   <font CLASS=comment>188:</font> <font CLASS=comment>// -------------------------</font>
   <font CLASS=comment>189:</font> 


</pre>

</div>


</body>
</html>